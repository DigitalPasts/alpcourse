<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mutual Pointwise Information – Ancient Language Processing 2026 / Gordin and Lincke</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-800d58d8a656452b2cf839acf4fa445e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Mutual Pointwise Information – Ancient Language Processing 2026 / Gordin and Lincke">
<meta property="og:description" content="">
<meta property="og:site_name" content="Ancient Language Processing 2026 / Gordin and Lincke">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../digpasts_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Ancient Language Processing 2026 / Gordin and Lincke</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">Course Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../coursework.html"> 
<span class="menu-text">Coursework</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-code-notebooks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Code Notebooks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-code-notebooks">    
        <li>
    <a class="dropdown-item" href="../notebooks/index.html">
 <span class="dropdown-text">Notebooks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/01_colab_intro.html">
 <span class="dropdown-text">Colab Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/02_Python_Brush_up.html">
 <span class="dropdown-text">Python Brush up</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/03_VectorizingTexts.html">
 <span class="dropdown-text">Vectorizing Texts</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html"> 
<span class="menu-text">Materials and Texts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#how-to-use" id="toc-how-to-use" class="nav-link active" data-scroll-target="#how-to-use">How to use?</a></li>
  <li><a href="#imports-and-constants" id="toc-imports-and-constants" class="nav-link" data-scroll-target="#imports-and-constants">Imports and constants</a></li>
  <li><a href="#functions-and-classes" id="toc-functions-and-classes" class="nav-link" data-scroll-target="#functions-and-classes">Functions and classes</a>
  <ul class="collapse">
  <li><a href="#logarithm-base-definition" id="toc-logarithm-base-definition" class="nav-link" data-scroll-target="#logarithm-base-definition">Logarithm base definition</a></li>
  <li><a href="#input-output-tools" id="toc-input-output-tools" class="nav-link" data-scroll-target="#input-output-tools">Input / Output tools</a></li>
  <li><a href="#word-association-measures" id="toc-word-association-measures" class="nav-link" data-scroll-target="#word-association-measures">Word association measures</a></li>
  <li><a href="#other-measures-and-statistical-tests" id="toc-other-measures-and-statistical-tests" class="nav-link" data-scroll-target="#other-measures-and-statistical-tests">Other measures and statistical tests</a></li>
  <li><a href="#context-similarity-weighting" id="toc-context-similarity-weighting" class="nav-link" data-scroll-target="#context-similarity-weighting">Context Similarity Weighting</a></li>
  <li><a href="#text-container-and-basic-text-analysis-tools" id="toc-text-container-and-basic-text-analysis-tools" class="nav-link" data-scroll-target="#text-container-and-basic-text-analysis-tools">Text container and basic text analysis tools</a></li>
  <li><a href="#association-measure-tools" id="toc-association-measure-tools" class="nav-link" data-scroll-target="#association-measure-tools">Association measure tools</a></li>
  </ul></li>
  <li><a href="#set-options-and-run-the-script" id="toc-set-options-and-run-the-script" class="nav-link" data-scroll-target="#set-options-and-run-the-script">Set options and run the script</a></li>
  <li><a href="#critical-bug-fixes" id="toc-critical-bug-fixes" class="nav-link" data-scroll-target="#critical-bug-fixes">Critical bug fixes</a></li>
  <li><a href="#other-fixes" id="toc-other-fixes" class="nav-link" data-scroll-target="#other-fixes">Other fixes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mutual Pointwise Information</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The code for this notebook has been prepared by <strong>Aleksi Sahala</strong> (University of Helsinki), 2019-2024, and is based on his research. It should be cited accordingly.</p>
<p><a href="github.com/asahala">github.com/asahala</a></p>
<section id="how-to-use" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use">How to use?</h2>
<ol type="1">
<li>Create text object (text per line, lemmas separated by space)</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> Text(<span class="st">'oracc-akkadian.txt'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Calculate co-occurrencies for the text object</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    cooc <span class="op">=</span> Associations(text,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                 words1<span class="op">=</span>[<span class="st">'*'</span>],            <span class="co"># All words to all words</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                 formulaic_measure<span class="op">=</span>Lazy,  <span class="co"># Use CSW</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                 minfreq_b <span class="op">=</span> <span class="dv">1</span>,           <span class="co"># Min freq of b</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                 minfreq_ab <span class="op">=</span> <span class="dv">1</span>,          <span class="co"># Min co-oc freq of a and b</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                 symmetry<span class="op">=</span><span class="va">True</span>,           <span class="co"># Window symmetry</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                 windowsize<span class="op">=</span><span class="dv">5</span>,            <span class="co"># Window size</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                 factorpower<span class="op">=</span><span class="dv">2</span>)           <span class="co"># k-value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Calculate PMI from co-occurrences from the associations object</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> cooc.score(PMI2)            <span class="co"># Select association measure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Print results from</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    x.print_scores(results, limit<span class="op">=</span><span class="dv">1000</span>, gephi<span class="op">=</span><span class="va">True</span>, filename<span class="op">=</span><span class="st">'oracc.pmi'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="imports-and-constants" class="level2">
<h2 class="anchored" data-anchor-id="imports-and-constants">Imports and constants</h2>
<div id="6d187a92" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:4,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from dictionary import dct</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statistics</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> quote</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tempfile</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#import os</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a3af472f" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:3,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-outputid="e8409c57-5714-4c88-8b21-a1de63ec7962" data-execution_count="2">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>__version__ <span class="op">=</span> <span class="st">"2024-05-19"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'pmizer.py version </span><span class="sc">%s</span><span class="ch">\n</span><span class="st">'</span> <span class="op">%</span> __version__)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">""" Constants """</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>WINDOW_SCALING <span class="op">=</span> <span class="va">True</span>     <span class="co"># Apply window size penalty to scores</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>LOGBASE <span class="op">=</span> <span class="dv">2</span>               <span class="co"># Logarithm base; set to None for ln</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>LACUNAE <span class="op">=</span> [<span class="st">'_'</span>]           <span class="co"># List of symbols for lacunae or removed words</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>LINEBREAK <span class="op">=</span> <span class="st">'&lt;LB&gt;'</span>        <span class="co"># Line break or text boundary</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>BUFFER <span class="op">=</span> <span class="st">'&lt;BF&gt;'</span>           <span class="co"># Buffer/padding symbol</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>INDENT <span class="op">=</span> <span class="dv">4</span>                <span class="co"># Indentation level for print</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>METASEPARATOR <span class="op">=</span> <span class="st">'|'</span>       <span class="co"># Character for separating multi-dimensional</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># metadata for JSON</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>WRAPCHARS <span class="op">=</span> [<span class="st">'['</span>, <span class="st">']'</span>]    <span class="co"># Wrap translations/POS-tags between these</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># symbols, e.g. ['"'] for "string". Give two</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># if beginning and end symbols are different</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>DECIMALSEPARATOR <span class="op">=</span> <span class="st">'.'</span>    <span class="co"># Decimal separator for output files</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>HIDE_MIN_SCORE <span class="op">=</span> <span class="va">True</span>     <span class="co"># Hide minimum scores in matrices</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>VERBOSE <span class="op">=</span> <span class="va">True</span>            <span class="co"># Print more info</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>IGNORE <span class="op">=</span> [LINEBREAK, BUFFER]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pmizer.py version 2024-05-19
</code></pre>
</div>
</div>
</section>
<section id="functions-and-classes" class="level2">
<h2 class="anchored" data-anchor-id="functions-and-classes">Functions and classes</h2>
<section id="logarithm-base-definition" class="level3">
<h3 class="anchored" data-anchor-id="logarithm-base-definition">Logarithm base definition</h3>
<div id="6fddb958" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log-base 2 should be used by default</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _log(n):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> LOGBASE <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> math.log(n)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> math.log(n, LOGBASE)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_korp_oracc_url(w1, w2, wz):</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Generate URL for Oracc in Korp """</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    w1 <span class="op">=</span> re.sub(<span class="st">'(.+)_.+?'</span>, <span class="vs">r'</span><span class="ch">\1</span><span class="vs">'</span>, w1)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    w2 <span class="op">=</span> re.sub(<span class="st">'(.+)_.+?'</span>, <span class="vs">r'</span><span class="ch">\1</span><span class="vs">'</span>, w2)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    w1 <span class="op">=</span> w1.split(<span class="st">'['</span>)[<span class="dv">0</span>]</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    w2 <span class="op">=</span> w2.split(<span class="st">'['</span>)[<span class="dv">0</span>]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    base <span class="op">=</span> <span class="st">'https://www.kielipankki.fi/korp/?mode=other_languages#'</span><span class="op">\</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>           <span class="st">'?lang=en&amp;stats_reduce=word'</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    cqp <span class="op">=</span> <span class="st">'&amp;cqp=%5Blemma</span><span class="sc">%20%</span><span class="st">3D</span><span class="sc">%20%</span><span class="st">22</span><span class="sc">{w1}%22%</span><span class="st">5D</span><span class="sc">%20%</span><span class="st">5B%5D%7B0,'</span><span class="op">\</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">'</span><span class="sc">{wz}</span><span class="st">%7D</span><span class="sc">%20%</span><span class="st">5Blemma</span><span class="sc">%20%</span><span class="st">3D</span><span class="sc">%20%</span><span class="st">22</span><span class="sc">{w2}%22%</span><span class="st">5D'</span><span class="op">\</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>          .<span class="bu">format</span>(w1<span class="op">=</span>quote(w1), w2<span class="op">=</span>quote(w2), wz<span class="op">=</span>wz)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    corps <span class="op">=</span> <span class="st">'&amp;corpus=oracc_adsd,oracc_ario,oracc_blms,oracc_cams,oracc_caspo,oracc_ctij'</span><span class="op">\</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">',oracc_dcclt,oracc_dccmt,oracc_ecut,oracc_etcsri,oracc_hbtin,oracc_obmc,'</span><span class="op">\</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'oracc_riao,oracc_ribo,oracc_rimanum,oracc_rinap,oracc_saao,'</span><span class="op">\</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'oracc_others&amp;search_tab=1&amp;search=cqp&amp;within=paragraph'</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">## TEMPORARY FOR ALP COURSE, REMOVE THE LINE BELOW</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    corps <span class="op">=</span> <span class="st">'&amp;corpus=oracc2021_rinap&amp;search_tab=1&amp;search=cqp&amp;within=paragraph'</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base<span class="op">+</span>cqp<span class="op">+</span>corps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="input-output-tools" class="level3">
<h3 class="anchored" data-anchor-id="input-output-tools">Input / Output tools</h3>
<div id="e71cf9b3" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> IO:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Basic file IO-operations and verbose """</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> read_file(filename):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Reading </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> filename)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>) <span class="im">as</span> data:</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> data.read().splitlines()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            IO.errormsg(<span class="st">"File not found: </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span> filename)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            sys.exit(<span class="dv">0</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> write_file(filename, content):</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> data:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            data.write(content)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Saved </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> filename)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> export_json(filename, content):</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Save lookup table as JSON """</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> data:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            json.dump(content, data)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Saved </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> filename)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> import_json(filename):</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Load lookup table from JSON """</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">': Reading </span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> filename)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(filename, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> data:</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> json.load(data)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            IO.errormsg(<span class="st">"File not found: </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span> filename)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            sys.exit(<span class="dv">0</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> show_time(time_, process):</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> VERBOSE:</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"</span><span class="sc">%s%s</span><span class="st"> took </span><span class="sc">%0.2f</span><span class="st"> seconds"</span> <span class="op">\</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                  <span class="op">%</span> (<span class="st">" "</span><span class="op">*</span>INDENT, process, <span class="bu">round</span>(time_, <span class="dv">2</span>)))</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> printmsg(message):</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> VERBOSE:</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(message)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> errormsg(message):</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">": Error! </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span> message)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="word-association-measures" class="level3">
<h3 class="anchored" data-anchor-id="word-association-measures">Word association measures</h3>
<p>Measures take four arguments:</p>
<ul>
<li>ab = co-oc freq</li>
<li>a = freq of a</li>
<li>b = freq of b</li>
<li>cz = corpus size</li>
<li>factor = CSW value (this is used if postweight is set)</li>
<li>oo = estimated number of all bigrams in the corpus</li>
</ul>
<div id="2ae374c6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">## POINTWISE MUTUAL INFORMATION BASED MEASURES</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PMI:</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Pointwise Mutual Information. The score orientation is</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    -log p(a,b) &gt; 0 &gt; -inf. As in Church &amp; Hanks 1990. """</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> raw(ab, a, b, cz, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (ab<span class="op">/</span>cz) <span class="op">/</span> ((a<span class="op">/</span>cz)<span class="op">*</span>(b<span class="op">/</span>cz))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> factor <span class="op">*</span> (_log(ab<span class="op">*</span>cz) <span class="op">-</span> _log(a<span class="op">*</span>b))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PMIDELTA:</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Smooth PMI (Pantel &amp; Lin 2002). This measure reduces</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">    the PMI score more, the rarer the words are, thus reducing</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">    the low-frequency bias """</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        weight <span class="op">=</span> (ab<span class="op">/</span>(ab<span class="op">+</span><span class="dv">1</span>)) <span class="op">*</span> (<span class="bu">min</span>(a,b)<span class="op">/</span>(<span class="bu">min</span>(a,b,)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> factor <span class="op">*</span> weight <span class="op">*</span> (_log(ab<span class="op">*</span>cz) <span class="op">-</span> _log(a<span class="op">*</span>b))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PMICDS:</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Context distribution smoothed PMI (Levy, Goldberg &amp;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Dagan 2015). This measure raises the f(b) to the power of</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">    alpha = 0.75 """</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">## WORKS ONLY IN MATRIX FACTORIZATION</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        alpha <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(factor <span class="op">*</span> _log((cz<span class="op">*</span>ab) <span class="op">/</span> (a<span class="op">*</span>(b<span class="op">**</span>alpha))),<span class="dv">0</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NPMI:</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Normalized PMI. The score orientation is  +1 &gt; 0 &gt; -1</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">    as in Bouma 2009 """</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> factor <span class="op">*</span> (PMI.score(ab, a, b, cz, <span class="dv">1</span>) <span class="op">/</span> <span class="op">-</span>_log(ab<span class="op">/</span>cz))</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PMISIG:</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Washtell &amp; Markert (2009). """</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        pa <span class="op">=</span> a <span class="op">/</span> cz</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        pb <span class="op">=</span> b <span class="op">/</span> cz</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> factor <span class="op">*</span> (math.sqrt(<span class="bu">min</span>(pa, pb))<span class="op">\</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>                         <span class="op">*</span> (PMI.raw(ab, a, b, cz)))</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SCISIG:</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Washtell &amp; Markert (2009) The original publication does</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co">    not tell the score orientation, but it can be shown to be</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co">    +1 &gt; √p(a,b) &gt; 0 """</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>        pa <span class="op">=</span> a <span class="op">/</span> cz</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>        pb <span class="op">=</span> b <span class="op">/</span> cz</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>        pab <span class="op">=</span> ab <span class="op">/</span> cz</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> factor <span class="op">*</span> (math.sqrt(<span class="bu">min</span>(pa, pb))<span class="op">\</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>                         <span class="op">*</span> (pab <span class="op">/</span> ((pa) <span class="op">*</span> math.sqrt(pb))))</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> cPMI:</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Corpus Level Significant PMI as in Damani 2013. According to</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="co">    the original research paper, delta value of 0.9 is recommended """</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>        delta <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> math.sqrt(_log(delta) <span class="op">/</span> (<span class="op">-</span><span class="dv">2</span> <span class="op">*</span> a))</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> _log(ab <span class="op">/</span> (a <span class="op">*</span> b <span class="op">/</span> cz) <span class="op">+</span> a <span class="op">*</span> t) <span class="op">*</span> factor</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PMI2:</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" PMI^2. Fixes the low-frequency bias of PMI and NPMI by squaring</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="co">    the numerator to compensate multiplication done in the denominnator.</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="co">    Scores are oriented as: 0 &gt; log p(a,b) &gt; -inf. As in Daille 1994 """</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (PMI.score(ab, a, b, cz, <span class="dv">1</span>) <span class="op">-</span> (<span class="op">-</span>_log(ab<span class="op">/</span>cz))) <span class="op">/</span> factor</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PMI3:</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" PMI^3 (no low-freq bias, favors common bigrams). Although not</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="co">    mentioned in any papers at my disposal, the scores are oriented</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="co">    log p(a,b) &gt; 2 log p(a,b) &gt; -inf. As in Daille 1994"""</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="op">-</span>math.inf</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (PMI.score(ab, a, b, cz, <span class="dv">1</span>) <span class="op">-</span> (<span class="op">-</span>(<span class="dv">2</span><span class="op">*</span>_log(ab<span class="op">/</span>cz)))) <span class="op">/</span> factor</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SPMI:</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Positive shifted PMI. Works as the regular PMI but discards negative</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a><span class="co">    scores: -log p(a,b) &gt; 0 = 0; Shift by 3 """</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">3</span> <span class="op">+</span> PMI.score(ab, a, b, cz, factor), <span class="dv">0</span>)</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PPMI:</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Positive PMI. Works as the regular PMI but discards negative</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a><span class="co">    scores: -log p(a,b) &gt; 0 = 0 """</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(PMI.score(ab, a, b, cz, factor), <span class="dv">0</span>)</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PPMI2:</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Positive derivative of PMI^2 as in Role &amp; Nadif 2011.</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a><span class="co">    Shares exaclty the same properties but the score orientation</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a><span class="co">    is on the positive plane: 1 &gt; 2^log p(a,b) &gt; 0 """</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> factor <span class="op">*</span> (<span class="dv">2</span> <span class="op">**</span> PMI2.score(ab, a, b, cz, <span class="dv">1</span>))</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PPMI3:</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Positive derivative of PMI^3. Shares exaclty the same properties</span></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a><span class="co">    but the score orientation is: p(a,b) &gt; p(a,b)^2 &gt; 0</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a><span class="co">    Not mentioned in Role &amp; Nadif """</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> factor <span class="op">*</span> (<span class="dv">2</span> <span class="op">**</span> PMI3.score(ab, a, b, cz, <span class="dv">1</span>))</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NPMI2:</span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" NPMI^2. Removes the low-frequency bias as PMI^2 and has</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a><span class="co">    a fixed score orientation as NPMI: 1 &gt; 0 = 0. Take cube root</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a><span class="co">    of the result to trim excess decimals. Sahala &amp; Linden (2020) """</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>        ind <span class="op">=</span> <span class="dv">2</span> <span class="op">**</span> _log(ab <span class="op">/</span> cz)</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>        base_score <span class="op">=</span> <span class="dv">2</span> <span class="op">**</span> PMI2.score(ab, a, b, cz, <span class="dv">1</span>) <span class="op">-</span> ind</span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="bu">max</span>(base_score <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> ind), <span class="dv">0</span>) <span class="op">*</span> factor) <span class="op">**</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NPMI3:</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" NPMI^3. Removes the low-frequency bias as PMI^3 and has</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a><span class="co">    a fixed score orientation as NPMI: 1 &gt; 0 = 0. Take cube root</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a><span class="co">    of the result to trim excess decimals. Sahala &amp; Linden (2020) """</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>        pab <span class="op">=</span> (ab<span class="op">/</span>cz)</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>        base_score <span class="op">=</span> <span class="dv">2</span> <span class="op">**</span> PMI3.score(ab, a, b, cz, <span class="dv">1</span>) <span class="op">-</span> (pab<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="bu">max</span>(base_score <span class="op">/</span> (pab <span class="op">-</span> (pab<span class="op">**</span><span class="dv">2</span>)), <span class="dv">0</span>) <span class="op">*</span> factor) <span class="op">**</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="other-measures-and-statistical-tests" class="level3">
<h3 class="anchored" data-anchor-id="other-measures-and-statistical-tests">Other measures and statistical tests</h3>
<div id="df7ab436" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> NormalizedExpectation:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Normalized Expectation as in Pecina 2006</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">       2f(xy) / f(x)f(y) """</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="dv">2</span><span class="op">*</span>ab<span class="op">*</span>factor) <span class="op">/</span> (a<span class="op">+</span>b)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> tTest:</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Student's t-test """</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        ind <span class="op">=</span> a<span class="op">*</span>b<span class="op">/</span>cz</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ((ab<span class="op">*</span>factor)<span class="op">-</span>ind) <span class="op">/</span> math.sqrt(factor<span class="op">*</span>ab<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>(factor<span class="op">*</span>ab<span class="op">/</span>cz)))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> zScore:</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Z-score """</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        ind <span class="op">=</span> a<span class="op">*</span>b<span class="op">/</span>cz</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ((ab<span class="op">*</span>factor)<span class="op">-</span>ind) <span class="op">/</span> math.sqrt(ind<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>(ind<span class="op">/</span>cz)))</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Association coefficients, See Pecina 2006</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> c_table(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Return contingency table. Note that the total number of</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co">    co-occurrences in the corpus is based on an estimate, because</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co">    not all bigrams are calculated for efficiency """</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    ab <span class="op">=</span> ab<span class="op">*</span>factor</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> ab</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> a <span class="op">-</span> ab</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> b <span class="op">-</span> ab</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    D <span class="op">=</span> oo <span class="op">-</span> ab</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, C, D</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Jaccard:</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        A, B, C, D <span class="op">=</span> c_table(ab, a, b, cz, factor, oo)</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> A <span class="op">/</span> (A<span class="op">+</span>B<span class="op">+</span>C)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Odds:</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>        A, B, C, D <span class="op">=</span> c_table(ab, a, b, cz, factor, oo)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (A<span class="op">*</span>D)<span class="op">/</span>(B<span class="op">*</span>C)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Simpson:</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Note: this has an extreme low-freq bias """</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>        A, B, C, D <span class="op">=</span> c_table(ab, a, b, cz, factor, oo)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> A <span class="op">/</span> <span class="bu">min</span>(A<span class="op">+</span>B, A<span class="op">+</span>C)</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BraunBlanquet:</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>        A, B, C, D <span class="op">=</span> c_table(ab, a, b, cz, factor, oo)</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> A <span class="op">/</span> <span class="bu">max</span>(A<span class="op">+</span>B, A<span class="op">+</span>C)</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Pearson:</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>        A, B, C, D <span class="op">=</span> c_table(ab, a, b, cz, factor, oo)</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>        u <span class="op">=</span> (A <span class="op">*</span> D) <span class="op">-</span> (B <span class="op">*</span> C)</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> math.sqrt((A<span class="op">+</span>B)<span class="op">*</span>(A<span class="op">+</span>C)<span class="op">*</span>(D<span class="op">+</span>B)<span class="op">*</span>(D<span class="op">+</span>C))</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> u <span class="op">/</span> d</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UnigramSubtuples:</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    minimum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(ab, a, b, cz, factor, oo<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>        A, B, C, D <span class="op">=</span> c_table(ab, a, b, cz, factor, oo)</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>        subs <span class="op">=</span> [<span class="dv">1</span><span class="op">/</span>A, <span class="dv">1</span><span class="op">/</span>B, <span class="dv">1</span><span class="op">/</span>C, <span class="dv">1</span><span class="op">/</span>D]</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> _log((A<span class="op">*</span>D)<span class="op">/</span>(B<span class="op">*</span>C)) <span class="op">-</span> (<span class="fl">3.29</span> <span class="op">*</span> math.sqrt(<span class="bu">sum</span>(subs)))</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="context-similarity-weighting" class="level3">
<h3 class="anchored" data-anchor-id="context-similarity-weighting">Context Similarity Weighting</h3>
<p>This is an initial version of CSW as in Sahala &amp; Linden (2020); performs similarly but has a space complexity of <code>O(n×m^2) (n = corpus size, m = window len)</code></p>
<p>Sahala, Aleksi &amp; Krister Lindén. 2020. <a href="https://researchportal.helsinki.fi/files/158886805/KDIR_2020_12_CR.pdf">Improving Word Association Measures in Repetitive Corpora with Context Similarity Weighting</a>, in: A L N Fred &amp; J Filipe (eds.), <em>Proceedings of the 12th International Joint Conference on Knowledge Discovery, Knowledge Engineering and Knowledge Management, IC3K 2020, Volume 1: KDIR, Budapest, Hungary, November 2-4, 2020.</em> SCITEPRESS Science And Technology Publications, Setúbal, 48–58, https://doi.org/10.5220/0010106800480058</p>
<div id="b98c4333" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FormulaicMeasures:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> compensate(words, collocate, uniqs):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Compensate window matrix counts:</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">        ´compensation´ is a number of each word that should be</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">        ignored in counting (metasymbols, collocates) """</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        compensation <span class="op">=</span> uniqs</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> symbol <span class="kw">in</span> LACUNAE <span class="op">+</span> [BUFFER, LINEBREAK, collocate]:</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            compensation <span class="op">+=</span> <span class="bu">max</span>(words.count(symbol) <span class="op">-</span> <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> compensation</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Greedy:</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Removed temporarily """</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Lazy:</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(windows, collocate):</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        diffs <span class="op">=</span> []</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> window <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>windows[::<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Count the number of unique words in transposed window matrix</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">            ie. stack windows and count uniques, see compensate() for more</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">            info """</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>            uniqs <span class="op">=</span> <span class="bu">len</span>(<span class="bu">set</span>(window))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>            compensated <span class="op">=</span> FormulaicMeasures.compensate(window, collocate, uniqs)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>            diffs.append((<span class="bu">len</span>(window) <span class="op">-</span> compensated) <span class="op">/</span> <span class="bu">len</span>(window))</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Uncomment to see probabilities """</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">#print('\t'.join(window), (len(window) - compensated) / len(window))</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sum</span>(diffs) <span class="op">/</span> <span class="bu">max</span>((<span class="bu">len</span>(diffs) <span class="op">-</span> <span class="dv">1</span>),<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="text-container-and-basic-text-analysis-tools" class="level3">
<h3 class="anchored" data-anchor-id="text-container-and-basic-text-analysis-tools">Text container and basic text analysis tools</h3>
<div id="1880a634" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898655951,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Text(<span class="bu">object</span>):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, filename, ignore<span class="op">=</span>LACUNAE):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.filename <span class="op">=</span> filename</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content <span class="op">=</span> []</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content_uniq <span class="op">=</span> []</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.metadata <span class="op">=</span> []</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.documents <span class="op">=</span> []</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.translations <span class="op">=</span> {}</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.ignore <span class="op">=</span> ignore</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._read(filename)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.stats</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _tokenize(string):</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> string.strip().split(<span class="st">' '</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _count(symbols, line):</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>([s <span class="cf">for</span> s <span class="kw">in</span> line <span class="cf">if</span> s <span class="kw">in</span> symbols])</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _read(<span class="va">self</span>, filename):</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        st <span class="op">=</span> time.time()</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Read input text from lemmatized raw text file """</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        metalength <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lacunacount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.maxlen <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.linecount <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.corpus_size <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> IO.read_file(<span class="va">self</span>.filename):</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> line:</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.linecount <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>                fields <span class="op">=</span> line.split(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                text <span class="op">=</span> fields[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> metalength <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                    metalength <span class="op">=</span> [<span class="bu">len</span>(fields)]</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> <span class="bu">len</span>(fields) <span class="kw">not</span> <span class="kw">in</span> metalength:</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                    IO.errormsg(<span class="st">'(</span><span class="sc">%s</span><span class="st"> at line </span><span class="sc">%i</span><span class="st">): Inconsistent '</span><span class="op">\</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'number of metadata fields.'</span> <span class="op">%</span> (<span class="va">self</span>.filename,</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                                                          <span class="va">self</span>.linecount))</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                    sys.exit(<span class="dv">0</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(fields) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                    <span class="co">""" Collect metadata """</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>                    meta <span class="op">=</span> METASEPARATOR.join(fields[<span class="dv">0</span>:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.metadata.append(meta)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>                lemmas <span class="op">=</span> <span class="va">self</span>._tokenize(text)</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>                <span class="co">""" Store documents for TF-IDF """</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.documents.append(lemmas)</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.lacunacount <span class="op">+=</span> <span class="va">self</span>._count(<span class="va">self</span>.ignore, lemmas)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>                <span class="co">""" Lacunae are count as lemmas but buffers are not """</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>                lemmacount <span class="op">=</span> <span class="bu">len</span>(lemmas)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.corpus_size <span class="op">+=</span> lemmacount</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> lemmacount <span class="op">&gt;</span> <span class="va">self</span>.maxlen:</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.maxlen <span class="op">=</span> lemmacount</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.content.extend([LINEBREAK] <span class="op">+</span> [BUFFER] <span class="op">+</span> lemmas)</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Add buffer to the end of the file """</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.content.extend([BUFFER])</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Make frequency list """</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.word_freqs <span class="op">=</span> Counter(<span class="va">self</span>.content)</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>        st2 <span class="op">=</span> time.time() <span class="op">-</span> st</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>        IO.show_time(st2, <span class="st">"Reading"</span>)</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>        IO.printmsg(<span class="va">self</span>.stats)</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> stats(<span class="va">self</span>):</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Return corpus statistics """</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>        tab <span class="op">=</span> INDENT <span class="op">*</span> <span class="st">' '</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        non_words <span class="op">=</span> [BUFFER, LINEBREAK]</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        freqs <span class="op">=</span> <span class="bu">sorted</span>([f <span class="cf">for</span> f <span class="kw">in</span> <span class="va">self</span>.word_freqs.values()])</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        log <span class="op">=</span> [(<span class="st">'</span><span class="ch">\n</span><span class="st">: Text statistics:'</span>),</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Lines: </span><span class="sc">%i</span><span class="st">'</span> <span class="op">%</span> (tab, <span class="va">self</span>.linecount)),</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Longest line: </span><span class="sc">%i</span><span class="st">'</span> <span class="op">%</span> (tab, <span class="va">self</span>.maxlen)),</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Word count: </span><span class="sc">%i</span><span class="st">'</span> <span class="op">%</span> (tab, <span class="va">self</span>.corpus_size)),</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Word count (non-lacunae): </span><span class="sc">%i</span><span class="st">'</span> <span class="op">\</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>                <span class="op">%</span> (tab, <span class="va">self</span>.corpus_size <span class="op">-</span> <span class="va">self</span>.lacunacount)),</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Lacunae or ignored symbols: </span><span class="sc">%i</span><span class="st">'</span> <span class="op">%</span> (tab, <span class="va">self</span>.lacunacount)),</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Unique words: </span><span class="sc">%i</span><span class="st">'</span> <span class="op">\</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>                <span class="op">%</span> (tab, <span class="bu">len</span>(<span class="va">self</span>.word_freqs.keys()) <span class="op">-</span> <span class="bu">len</span>(non_words))),</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Median word frequency: </span><span class="sc">%i</span><span class="st">'</span> <span class="op">\</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>                <span class="op">%</span> (tab, statistics.median(freqs))),</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>               (<span class="st">'</span><span class="sc">%s</span><span class="st">Average word frequency: </span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">\</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>                <span class="op">%</span> (tab, <span class="bu">sum</span>(freqs) <span class="op">/</span> <span class="bu">len</span>(freqs)))]</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(log) <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> metadata_stats(<span class="va">self</span>):</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Return word and line counts for each metadata group """</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.metadata:</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>        meta <span class="op">=</span> {}</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>        tab <span class="op">=</span> <span class="st">' '</span><span class="op">*</span>INDENT</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, content <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.documents):</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>            wordcount <span class="op">=</span> <span class="bu">len</span>(content)</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>            meta.setdefault(<span class="va">self</span>.metadata[index], {<span class="st">'words'</span>: <span class="dv">0</span>, <span class="st">'lines'</span>: <span class="dv">0</span>})</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>            meta[<span class="va">self</span>.metadata[index]][<span class="st">'words'</span>] <span class="op">+=</span> wordcount</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>            meta[<span class="va">self</span>.metadata[index]][<span class="st">'lines'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span><span class="op">+</span><span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join([(<span class="st">'</span><span class="sc">%s%s</span><span class="ch">\t</span><span class="sc">%i</span><span class="ch">\t</span><span class="sc">%i</span><span class="st">'</span> <span class="op">\</span></span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>                <span class="op">%</span> (tab, k.replace(METASEPARATOR, <span class="st">'</span><span class="ch">\t</span><span class="st">'</span>), v[<span class="st">'words'</span>], v[<span class="st">'lines'</span>]))<span class="op">\</span></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">sorted</span>(meta.items())]) <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> iterate(<span class="va">self</span>, windowsize<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Iterate content of the text and extend buffers to match</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a><span class="co">        window size """</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> word <span class="kw">in</span> <span class="va">self</span>.content:</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word <span class="op">==</span> BUFFER:</span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, windowsize):</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">yield</span> word</span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>                <span class="cf">yield</span> word</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> tf_idf(<span class="va">self</span>, threshold<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Returns a TF-IDF based stopword list based on the text.</span></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a><span class="co">        This can be passed to Associations() as a keyword argument</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a><span class="co">        ´threshold´ defines the size of the list, if no argument is</span></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a><span class="co">        give, will return a list relative to corpus size """</span></span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Making TF-IDF stopword list'</span>)</span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>        st <span class="op">=</span> time.time()</span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>        tf_idfs <span class="op">=</span> {}</span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>        words <span class="op">=</span> []</span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> threshold <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>            threshold <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.000005</span> <span class="op">*</span> <span class="va">self</span>.corpus_size)</span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> document <span class="kw">in</span> <span class="va">self</span>.documents:</span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>            N <span class="op">=</span> <span class="bu">len</span>(document)</span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> word <span class="kw">in</span> <span class="bu">set</span>(document):</span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> document.count(word)</span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a>                tf_idfs.setdefault(word, {<span class="st">'tf'</span>: [], <span class="st">'found_in'</span>: <span class="dv">0</span>})</span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a>                tf_idfs[word][<span class="st">'tf'</span>].append(t<span class="op">/</span>N)</span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a>                tf_idfs[word][<span class="st">'found_in'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> word, vals <span class="kw">in</span> tf_idfs.items():</span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a>            scores <span class="op">=</span> []</span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> tf <span class="kw">in</span> vals[<span class="st">'tf'</span>]:</span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a>                scores.append(tf <span class="op">*</span> math.log(<span class="bu">len</span>(<span class="va">self</span>.documents)<span class="op">/</span>vals[<span class="st">'found_in'</span>], <span class="dv">10</span>))</span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a>            words.append([<span class="bu">sum</span>(scores), word])</span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a>        st2 <span class="op">=</span> time.time() <span class="op">-</span> st</span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a>        IO.show_time(st2, <span class="st">"TF-IDF"</span>)</span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [x[<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">sorted</span>(words, reverse<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>:threshold]]</span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> read_dict(<span class="va">self</span>):</span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> <span class="va">self</span>.filename.split(<span class="st">'.'</span>)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'.dict'</span></span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>) <span class="im">as</span> data:</span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> line <span class="kw">in</span> data.read().splitlines():</span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>                key, value <span class="op">=</span> line.split(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.translations[key] <span class="op">=</span> value</span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> uniquify(<span class="va">self</span>, wz):</span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This feature is not finished</span></span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Produce a version of text that do not need window scaling.</span></span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a><span class="co">        Iterate text and disallow words occurring more than once</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a><span class="co">        withing a given distance from each other. Replace non-unique</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a><span class="co">        words with lacunae """</span></span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Uniquifying windows'</span>)</span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a>        st <span class="op">=</span> time.time()</span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a>        count_non_lacunae <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a>        removed <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> word <span class="kw">in</span> <span class="va">self</span>.content:</span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Initialize buffer """</span></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word <span class="op">==</span> LINEBREAK:</span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a>                <span class="bu">buffer</span> <span class="op">=</span> []</span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Keep buffer length """</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">buffer</span>) <span class="op">==</span> wz <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a>                <span class="bu">buffer</span>.pop(<span class="dv">0</span>)</span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Replace non-uniques with lacunae """</span></span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word <span class="kw">in</span> <span class="bu">buffer</span> <span class="kw">and</span> word <span class="kw">not</span> <span class="kw">in</span> LACUNAE <span class="op">+</span> IGNORE:</span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a>                removed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a>                word <span class="op">=</span> LACUNAE[<span class="dv">0</span>]</span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> IGNORE:</span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a>                count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> LACUNAE:</span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a>                    count_non_lacunae <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a>            <span class="bu">buffer</span>.append(word)</span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.content_uniq.append(word)</span>
<span id="cb13-201"><a href="#cb13-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-202"><a href="#cb13-202" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.corpus_size_uniq <span class="op">=</span> Counter(<span class="va">self</span>.content_uniq)</span>
<span id="cb13-203"><a href="#cb13-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-204"><a href="#cb13-204" aria-hidden="true" tabindex="-1"></a>        st2 <span class="op">=</span> time.time() <span class="op">-</span> st</span>
<span id="cb13-205"><a href="#cb13-205" aria-hidden="true" tabindex="-1"></a>        IO.show_time(st2, <span class="st">"Uniquifying"</span>)</span>
<span id="cb13-206"><a href="#cb13-206" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="sc">%s</span><span class="st">--&gt; </span><span class="sc">%i</span><span class="st"> words removed"</span> <span class="op">\</span></span>
<span id="cb13-207"><a href="#cb13-207" aria-hidden="true" tabindex="-1"></a>              <span class="op">%</span> (<span class="st">' '</span><span class="op">*</span>INDENT, removed))</span>
<span id="cb13-208"><a href="#cb13-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-209"><a href="#cb13-209" aria-hidden="true" tabindex="-1"></a>        <span class="co">#for k, v in sorted(Counter(removed).items()):</span></span>
<span id="cb13-210"><a href="#cb13-210" aria-hidden="true" tabindex="-1"></a>        <span class="co">#    print(v, k)</span></span>
<span id="cb13-211"><a href="#cb13-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-212"><a href="#cb13-212" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" ================================================================</span></span>
<span id="cb13-213"><a href="#cb13-213" aria-hidden="true" tabindex="-1"></a><span class="co">    Random sampling tools (for measure evaluation purposes)</span></span>
<span id="cb13-214"><a href="#cb13-214" aria-hidden="true" tabindex="-1"></a><span class="co">    ================================================================ """</span></span>
<span id="cb13-215"><a href="#cb13-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-216"><a href="#cb13-216" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Sample a population of words from frequency list from</span></span>
<span id="cb13-217"><a href="#cb13-217" aria-hidden="true" tabindex="-1"></a><span class="co">    given frequency range. ´quantity´ is the population size and</span></span>
<span id="cb13-218"><a href="#cb13-218" aria-hidden="true" tabindex="-1"></a><span class="co">    ´freq_range´ a list that contains the min and max freq,</span></span>
<span id="cb13-219"><a href="#cb13-219" aria-hidden="true" tabindex="-1"></a><span class="co">    e.g. [30,50] """</span></span>
<span id="cb13-220"><a href="#cb13-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-221"><a href="#cb13-221" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> pick_random(<span class="va">self</span>, quantity, freq_range):</span>
<span id="cb13-222"><a href="#cb13-222" aria-hidden="true" tabindex="-1"></a>        sampled <span class="op">=</span> []</span>
<span id="cb13-223"><a href="#cb13-223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> <span class="va">self</span>.word_freqs.items():</span>
<span id="cb13-224"><a href="#cb13-224" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> freq_range[<span class="dv">1</span>] <span class="op">&gt;</span> v <span class="op">&gt;</span> freq_range[<span class="dv">0</span>]:</span>
<span id="cb13-225"><a href="#cb13-225" aria-hidden="true" tabindex="-1"></a>                sampled.append(k)</span>
<span id="cb13-226"><a href="#cb13-226" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.random_sample <span class="op">=</span> random.sample(sampled, quantity)</span>
<span id="cb13-227"><a href="#cb13-227" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.random_sample</span>
<span id="cb13-228"><a href="#cb13-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-229"><a href="#cb13-229" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Random samples can be saved and loaded with the</span></span>
<span id="cb13-230"><a href="#cb13-230" aria-hidden="true" tabindex="-1"></a><span class="co">    following funtions """</span></span>
<span id="cb13-231"><a href="#cb13-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-232"><a href="#cb13-232" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_random(<span class="va">self</span>, filename):</span>
<span id="cb13-233"><a href="#cb13-233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> data:</span>
<span id="cb13-234"><a href="#cb13-234" aria-hidden="true" tabindex="-1"></a>            data.write(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(<span class="va">self</span>.random_sample))</span>
<span id="cb13-235"><a href="#cb13-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-236"><a href="#cb13-236" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_random(<span class="va">self</span>, filename):</span>
<span id="cb13-237"><a href="#cb13-237" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> data:</span>
<span id="cb13-238"><a href="#cb13-238" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.random_sample <span class="op">=</span> data.read().splitlines()</span>
<span id="cb13-239"><a href="#cb13-239" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.random_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="association-measure-tools" class="level3">
<h3 class="anchored" data-anchor-id="association-measure-tools">Association measure tools</h3>
<div id="8e8c1531" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898656401,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Associations:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, text, <span class="op">**</span>kwargs):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(text, Text):</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            IO.errormsg(<span class="st">'Association must have Text object as argument.'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            sys.exit(<span class="dv">0</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.text <span class="op">=</span> text</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.word_freqs <span class="op">=</span> <span class="va">self</span>.text.word_freqs</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.corpus_size <span class="op">=</span> <span class="va">self</span>.text.corpus_size</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.windowsize <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.minfreq_b <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.minfreq_ab <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.distances <span class="op">=</span> {}</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.WINS <span class="op">=</span> {}</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.translations <span class="op">=</span> {}</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.text.translations:</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.translations <span class="op">=</span> <span class="va">self</span>.text.translations</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.track_distance <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.symmetry <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.track_distance <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.positive_condition <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.formulaic_measure <span class="op">=</span> <span class="va">None</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.postweight <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.factorpower <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.words <span class="op">=</span> {<span class="dv">1</span>: [], <span class="dv">2</span>: []}</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.regex_words <span class="op">=</span> {<span class="dv">1</span>: [], <span class="dv">2</span>: []}</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.metadata <span class="op">=</span> {}</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.conditions <span class="op">=</span> {<span class="st">'stopwords'</span>: LACUNAE <span class="op">+</span> [<span class="st">''</span>, BUFFER, LINEBREAK],</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'stopwords_regex'</span>: [],</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'conditions'</span>: [],</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'conditions_regex'</span>: []}</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.set_constraints(<span class="op">**</span>kwargs)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.count_bigrams()</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.corpus_size <span class="op">&lt;</span> <span class="va">self</span>.windowsize:</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>            IO.errormsg(<span class="st">'Window size exceeds corpus size.'</span>)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>            sys.exit(<span class="dv">1</span>)</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__repr__</span>(<span class="va">self</span>):</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Define what is not shown in .log files """</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>        debug <span class="op">=</span> []</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>        tab <span class="op">=</span> <span class="bu">max</span>([<span class="bu">len</span>(k)<span class="op">+</span><span class="dv">2</span> <span class="cf">for</span> k <span class="kw">in</span> <span class="va">self</span>.__dict__.keys()])</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">sorted</span>(<span class="va">self</span>.__dict__.keys()):</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'scored'</span>, <span class="st">'text'</span>, <span class="st">'regex_stopwords'</span>, <span class="st">'metadata'</span>,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'regex_words'</span>, <span class="st">'distances'</span>, <span class="st">'anywords'</span>,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'anywords1'</span>, <span class="st">'output'</span>, <span class="st">'anywords2'</span>, <span class="st">'bigram_freqs'</span>,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'anycondition'</span>, <span class="st">'word_freqs'</span>, <span class="st">'positive_condition'</span>,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'minimum'</span>, <span class="st">'WINS'</span>, <span class="st">'documents'</span>, <span class="st">'translations'</span>]:</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>                v <span class="op">=</span> <span class="va">self</span>.__dict__[k]</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>                debug.append(<span class="st">'</span><span class="sc">%s%s%s</span><span class="st">'</span> <span class="op">%</span> (k, <span class="st">' '</span><span class="op">*</span>(tab<span class="op">-</span><span class="bu">len</span>(k)<span class="op">+</span><span class="dv">1</span>), <span class="bu">str</span>(v)))</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(debug) <span class="op">+</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span> <span class="op">+</span> <span class="st">'-'</span><span class="op">*</span><span class="dv">20</span> <span class="op">+\</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>               <span class="st">' </span><span class="ch">\n</span><span class="st">pmizer version: '</span> <span class="op">+</span> __version__</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_constraints(<span class="va">self</span>, <span class="op">**</span>kwargs):</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Set constraints. Separate regular expressions from the</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="co">        string variables, as string comparison is significantly faster</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="co">        than re.match() """</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> key, value <span class="kw">in</span> kwargs.items():</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> key <span class="kw">in</span> [<span class="st">'stopwords'</span>, <span class="st">'conditions'</span>]:</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> word <span class="kw">in</span> value:</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(word, <span class="bu">str</span>):</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.conditions[key].append(word)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.conditions[key<span class="op">+</span><span class="st">'_regex'</span>].append(word)</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> key <span class="kw">in</span> [<span class="st">'words1'</span>, <span class="st">'words2'</span>]:</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>                index <span class="op">=</span> <span class="bu">int</span>(key[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> word <span class="kw">in</span> value:</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">isinstance</span>(word, <span class="bu">str</span>):</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.words[index].append(word)</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.regex_words[index].append(word)</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>                <span class="bu">setattr</span>(<span class="va">self</span>, key, value)</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Combine tables for faster comparison """</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.anywords <span class="op">=</span> <span class="bu">any</span>([<span class="va">self</span>.words[<span class="dv">1</span>], <span class="va">self</span>.words[<span class="dv">2</span>],</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>                         <span class="va">self</span>.regex_words[<span class="dv">1</span>], <span class="va">self</span>.regex_words[<span class="dv">2</span>]])</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.anywords1 <span class="op">=</span> <span class="bu">any</span>([<span class="va">self</span>.words[<span class="dv">1</span>], <span class="va">self</span>.regex_words[<span class="dv">1</span>]])</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.anywords2 <span class="op">=</span> <span class="bu">any</span>([<span class="va">self</span>.words[<span class="dv">2</span>], <span class="va">self</span>.regex_words[<span class="dv">2</span>]])</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.anycondition <span class="op">=</span> <span class="bu">any</span>([<span class="va">self</span>.conditions[<span class="st">'conditions'</span>],</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>                                 <span class="va">self</span>.conditions[<span class="st">'conditions_regex'</span>]])</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" ================================================================</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="co">    Helper funtions ====================================================</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a><span class="co">    ================================================================ """</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _trim_float(<span class="va">self</span>, number):</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> number:</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> number</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">isinstance</span>(number, <span class="bu">int</span>):</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> number</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">round</span>(number, <span class="dv">3</span>)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_translation(<span class="va">self</span>, word):</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Get translation from dictionary """</span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>            translation <span class="op">=</span> <span class="st">'</span><span class="sc">%s%s%s</span><span class="st">'</span> <span class="op">%</span> (WRAPCHARS[<span class="dv">0</span>], <span class="va">self</span>.translations[word], WRAPCHARS[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>            translation <span class="op">=</span> <span class="st">'</span><span class="sc">%s</span><span class="st">?</span><span class="sc">%s</span><span class="st">'</span> <span class="op">%</span> (WRAPCHARS[<span class="dv">0</span>], WRAPCHARS[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> translation</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _get_distance(<span class="va">self</span>, bigram):</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Calculate average distance for bigram's words; if not</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a><span class="co">        used, the distance will be equal to window size. """</span></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.track_distance:</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>            distance <span class="op">=</span> <span class="va">self</span>._trim_float(<span class="bu">sum</span>(<span class="va">self</span>.distances[bigram])</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">/</span> <span class="bu">len</span>(<span class="va">self</span>.distances[bigram]))</span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>            distance <span class="op">=</span> <span class="st">''</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> distance</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _match_regex(<span class="va">self</span>, words, regexes):</span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Matches a list of regexes to list of words """</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">any</span>([re.match(r, w) <span class="cf">for</span> r <span class="kw">in</span> regexes <span class="cf">for</span> w <span class="kw">in</span> words])</span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _meets_anycondition(<span class="va">self</span>, condition, words):</span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Compare words with stopword/conditions list and regexes. """</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.conditions[condition <span class="op">+</span><span class="st">'_regex'</span>]:</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">any</span>(w <span class="kw">in</span> <span class="va">self</span>.conditions[condition] <span class="cf">for</span> w <span class="kw">in</span> words)</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._match_regex(words, <span class="va">self</span>.conditions[condition<span class="op">+</span><span class="st">'_regex'</span>])<span class="op">\</span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">or</span> <span class="bu">any</span>(w <span class="kw">in</span> <span class="va">self</span>.conditions[condition] <span class="cf">for</span> w <span class="kw">in</span> words)</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _is_wordofinterest(<span class="va">self</span>, word, index):</span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Compare words with the list of words of interest.</span></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a><span class="co">        Return True if in the list; never accept lacunae or buffers """</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.words[<span class="dv">1</span>] <span class="op">==</span> [<span class="st">'*'</span>] <span class="kw">and</span> word <span class="kw">not</span> <span class="kw">in</span> [LINEBREAK, BUFFER]:</span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> word <span class="kw">in</span> [LINEBREAK, BUFFER]:</span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.regex_words[index]:</span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> word <span class="kw">in</span> <span class="va">self</span>.words[index]</span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._match_regex([word], <span class="va">self</span>.regex_words[index])<span class="op">\</span></span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>                   <span class="kw">or</span> word <span class="kw">in</span> <span class="va">self</span>.words[index]</span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _is_valid(<span class="va">self</span>, w1, w2, freq):</span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Validate bigram. Discard stopwords and those which</span></span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a><span class="co">        do not match with the word of interest lists """</span></span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> freq <span class="op">&gt;=</span> <span class="va">self</span>.minfreq_ab <span class="kw">and</span> <span class="va">self</span>.word_freqs[w2] <span class="op">&gt;=</span> <span class="va">self</span>.minfreq_b:</span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.anywords:</span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="kw">not</span> <span class="va">self</span>._meets_anycondition(<span class="st">'stopwords'</span>, [w1, w2])</span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="va">self</span>.anywords <span class="kw">and</span> <span class="va">self</span>.anywords2:</span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">self</span>._is_wordofinterest(w1, <span class="dv">1</span>) <span class="kw">and</span><span class="op">\</span></span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a>                       <span class="va">self</span>._is_wordofinterest(w2, <span class="dv">2</span>)</span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.anywords1:</span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">self</span>._is_wordofinterest(w1, <span class="dv">1</span>) <span class="kw">and</span><span class="op">\</span></span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a>                           <span class="kw">not</span> <span class="va">self</span>._meets_anycondition(<span class="st">'stopwords'</span>, [w2])</span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.anywords2:</span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">self</span>._is_wordofinterest(w2, <span class="dv">2</span>) <span class="kw">and</span><span class="op">\</span></span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a>                           <span class="kw">not</span> <span class="va">self</span>._meets_anycondition(<span class="st">'stopwords'</span>, [w1])</span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _has_condition(<span class="va">self</span>, window):</span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Check if conditions are defined. Validate window if true """</span></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.anycondition:</span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.positive_condition:</span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._meets_anycondition(<span class="st">'conditions'</span>, window):</span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="kw">not</span> <span class="va">self</span>.positive_condition:</span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._meets_anycondition(<span class="st">'conditions'</span>, window):</span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">'positive_condition must be True or False'</span>)</span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a>                sys.exit(<span class="dv">1</span>)</span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" ================================================================</span></span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a><span class="co">    Bigram counting ====================================================</span></span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a><span class="co">    ================================================================ """</span></span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> count_bigrams(<span class="va">self</span>):</span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Counting bigrams'</span>)</span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a>        st <span class="op">=</span> time.time()</span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Set has_meta if metadata is available. """</span></span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a>        has_meta <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.text.metadata) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>.text.iterate())</span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _check_formulaic(bigram, window, index):</span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Store windows only if formulaic_measures are used,</span></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a><span class="co">            otherwise skip this to save memory and time. Remove</span></span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a><span class="co">            index of the collocate from the window to preserve only</span></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a><span class="co">            context of the bigram """</span></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.formulaic_measure <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a>                <span class="co">#window.pop(index)</span></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a>                window[index] <span class="op">=</span> LACUNAE[<span class="dv">0</span>]</span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.WINS.setdefault(bigram, []).append(window)</span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> bigram</span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _gather_meta(bigram, meta):</span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Get bigram distribution by metadata """</span></span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.metadata.setdefault(bigram, {})</span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.metadata[bigram].setdefault(meta, <span class="dv">0</span>)</span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.metadata[bigram][meta] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> count_bigrams_symmetric():</span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Symmetric window """</span></span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a>            wz <span class="op">=</span> <span class="va">self</span>.windowsize <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a>            <span class="co">#dupes = []</span></span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> w <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>[text[i:] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span><span class="op">+</span>wz<span class="op">*</span><span class="dv">2</span>)]):</span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a>                <span class="co">#W = [o for o in w if o not in ('_', '&lt;LB&gt;', '&lt;BF&gt;')]</span></span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a>                <span class="co">#UNIQ = sorted(list(set(W)))</span></span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a>                <span class="co">#if UNIQ == sorted(W):</span></span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a>                <span class="co">#    pass</span></span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a>                <span class="co">#else:</span></span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a>                <span class="co">#    dupes.append(W)</span></span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> w[<span class="dv">0</span>] <span class="op">==</span> LINEBREAK:</span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> has_meta:</span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a>                        meta <span class="op">=</span> <span class="va">self</span>.text.metadata.pop(<span class="dv">0</span>)</span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_wordofinterest(w[wz], <span class="dv">1</span>) <span class="kw">and</span> <span class="op">\</span></span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a>                   <span class="va">self</span>._has_condition(w[<span class="dv">0</span>:wz]<span class="op">+</span>w[wz<span class="op">+</span><span class="dv">1</span>:]):</span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> index, bigram <span class="kw">in</span> <span class="bu">enumerate</span>(itertools.product([w[wz]],</span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a>                                                    w[<span class="dv">0</span>:wz]<span class="op">+</span>w[wz<span class="op">+</span><span class="dv">1</span>:])):</span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> has_meta:</span>
<span id="cb14-245"><a href="#cb14-245" aria-hidden="true" tabindex="-1"></a>                            _gather_meta(bigram, meta)</span>
<span id="cb14-246"><a href="#cb14-246" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">yield</span> _check_formulaic(bigram,</span>
<span id="cb14-247"><a href="#cb14-247" aria-hidden="true" tabindex="-1"></a>                                               <span class="bu">list</span>(w[<span class="dv">0</span>:wz]<span class="op">+</span>w[wz<span class="op">+</span><span class="dv">1</span>:]),</span>
<span id="cb14-248"><a href="#cb14-248" aria-hidden="true" tabindex="-1"></a>                                               index)</span>
<span id="cb14-249"><a href="#cb14-249" aria-hidden="true" tabindex="-1"></a>            <span class="co">#for x in dupes:</span></span>
<span id="cb14-250"><a href="#cb14-250" aria-hidden="true" tabindex="-1"></a>            <span class="co">#    print(x)</span></span>
<span id="cb14-251"><a href="#cb14-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-252"><a href="#cb14-252" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> count_bigrams_symmetric_dist():</span>
<span id="cb14-253"><a href="#cb14-253" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Symmetric window and distance tracking. """</span></span>
<span id="cb14-254"><a href="#cb14-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-255"><a href="#cb14-255" aria-hidden="true" tabindex="-1"></a>            <span class="kw">def</span> chain(w1, w2):</span>
<span id="cb14-256"><a href="#cb14-256" aria-hidden="true" tabindex="-1"></a>                <span class="co">""" Return convolution chain of two lists.</span></span>
<span id="cb14-257"><a href="#cb14-257" aria-hidden="true" tabindex="-1"></a><span class="co">                [a, b], [c, d] -&gt; [a, c, b, d] """</span></span>
<span id="cb14-258"><a href="#cb14-258" aria-hidden="true" tabindex="-1"></a>                chain <span class="op">=</span> [<span class="st">' '</span>] <span class="op">*</span> <span class="bu">len</span>(w1<span class="op">+</span>w2)</span>
<span id="cb14-259"><a href="#cb14-259" aria-hidden="true" tabindex="-1"></a>                chain[::<span class="dv">2</span>] <span class="op">=</span> w1</span>
<span id="cb14-260"><a href="#cb14-260" aria-hidden="true" tabindex="-1"></a>                chain[<span class="dv">1</span>::<span class="dv">2</span>] <span class="op">=</span> w2</span>
<span id="cb14-261"><a href="#cb14-261" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> chain</span>
<span id="cb14-262"><a href="#cb14-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-263"><a href="#cb14-263" aria-hidden="true" tabindex="-1"></a>            wz <span class="op">=</span> <span class="va">self</span>.windowsize <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb14-264"><a href="#cb14-264" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> w <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>[text[i:] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span><span class="op">+</span>wz<span class="op">*</span><span class="dv">2</span>)]):</span>
<span id="cb14-265"><a href="#cb14-265" aria-hidden="true" tabindex="-1"></a>                left <span class="op">=</span> <span class="bu">list</span>(w[<span class="dv">0</span>:wz])</span>
<span id="cb14-266"><a href="#cb14-266" aria-hidden="true" tabindex="-1"></a>                right <span class="op">=</span> <span class="bu">list</span>(w[wz<span class="op">+</span><span class="dv">1</span>:])</span>
<span id="cb14-267"><a href="#cb14-267" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> w[<span class="dv">0</span>] <span class="op">==</span> LINEBREAK:</span>
<span id="cb14-268"><a href="#cb14-268" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> has_meta:</span>
<span id="cb14-269"><a href="#cb14-269" aria-hidden="true" tabindex="-1"></a>                        meta <span class="op">=</span> <span class="va">self</span>.text.metadata.pop(<span class="dv">0</span>)</span>
<span id="cb14-270"><a href="#cb14-270" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_wordofinterest(w[wz], <span class="dv">1</span>) <span class="kw">and</span> <span class="op">\</span></span>
<span id="cb14-271"><a href="#cb14-271" aria-hidden="true" tabindex="-1"></a>                   <span class="va">self</span>._has_condition(left<span class="op">+</span>right):</span>
<span id="cb14-272"><a href="#cb14-272" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> index, bigram <span class="kw">in</span> <span class="bu">enumerate</span>(itertools.product([w[wz]],</span>
<span id="cb14-273"><a href="#cb14-273" aria-hidden="true" tabindex="-1"></a>                                                    left<span class="op">+</span>right)):</span>
<span id="cb14-274"><a href="#cb14-274" aria-hidden="true" tabindex="-1"></a>                        bigram <span class="op">=</span> _check_formulaic(bigram, left<span class="op">+</span>right, index)</span>
<span id="cb14-275"><a href="#cb14-275" aria-hidden="true" tabindex="-1"></a>                        context <span class="op">=</span> chain(left[::<span class="op">-</span><span class="dv">1</span>], right)</span>
<span id="cb14-276"><a href="#cb14-276" aria-hidden="true" tabindex="-1"></a>                        min_dist <span class="op">=</span> math.floor(context.index(bigram[<span class="dv">1</span>])<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-277"><a href="#cb14-277" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> has_meta:</span>
<span id="cb14-278"><a href="#cb14-278" aria-hidden="true" tabindex="-1"></a>                            _gather_meta(bigram, meta)</span>
<span id="cb14-279"><a href="#cb14-279" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.distances.setdefault(bigram, []).append(min_dist)</span>
<span id="cb14-280"><a href="#cb14-280" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">yield</span> bigram</span>
<span id="cb14-281"><a href="#cb14-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-282"><a href="#cb14-282" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> count_bigrams_forward():</span>
<span id="cb14-283"><a href="#cb14-283" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Calculate bigrams within each forward-looking window """</span></span>
<span id="cb14-284"><a href="#cb14-284" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> w <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>[text[i:] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.windowsize)]):</span>
<span id="cb14-285"><a href="#cb14-285" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> w[<span class="dv">0</span>] <span class="op">==</span> LINEBREAK:</span>
<span id="cb14-286"><a href="#cb14-286" aria-hidden="true" tabindex="-1"></a>                    <span class="co">""" Keep track of lines and their metadata """</span></span>
<span id="cb14-287"><a href="#cb14-287" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> has_meta:</span>
<span id="cb14-288"><a href="#cb14-288" aria-hidden="true" tabindex="-1"></a>                        meta <span class="op">=</span> <span class="va">self</span>.text.metadata.pop(<span class="dv">0</span>)</span>
<span id="cb14-289"><a href="#cb14-289" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_wordofinterest(w[<span class="dv">0</span>], <span class="dv">1</span>) <span class="op">\</span></span>
<span id="cb14-290"><a href="#cb14-290" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">and</span> <span class="va">self</span>._has_condition(w[<span class="dv">1</span>:]):</span>
<span id="cb14-291"><a href="#cb14-291" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> index, bigram <span class="kw">in</span> <span class="bu">enumerate</span>(itertools.product([w[<span class="dv">0</span>]],</span>
<span id="cb14-292"><a href="#cb14-292" aria-hidden="true" tabindex="-1"></a>                                                    w[<span class="dv">1</span>:])):</span>
<span id="cb14-293"><a href="#cb14-293" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> has_meta:</span>
<span id="cb14-294"><a href="#cb14-294" aria-hidden="true" tabindex="-1"></a>                            <span class="co">""" If metadata is available, store it """</span></span>
<span id="cb14-295"><a href="#cb14-295" aria-hidden="true" tabindex="-1"></a>                            _gather_meta(bigram, meta)</span>
<span id="cb14-296"><a href="#cb14-296" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">yield</span> _check_formulaic(bigram, <span class="bu">list</span>(w[<span class="dv">1</span>:]), index)</span>
<span id="cb14-297"><a href="#cb14-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-298"><a href="#cb14-298" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> count_bigrams_forward_dist():</span>
<span id="cb14-299"><a href="#cb14-299" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Calculate bigrams within each forward-looking window,</span></span>
<span id="cb14-300"><a href="#cb14-300" aria-hidden="true" tabindex="-1"></a><span class="co">            calculate also average distance between words. Distance</span></span>
<span id="cb14-301"><a href="#cb14-301" aria-hidden="true" tabindex="-1"></a><span class="co">            tracking is not included into count_bigrams_forward()</span></span>
<span id="cb14-302"><a href="#cb14-302" aria-hidden="true" tabindex="-1"></a><span class="co">            for better efficiency """</span></span>
<span id="cb14-303"><a href="#cb14-303" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> w <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>[text[i:] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.windowsize)]):</span>
<span id="cb14-304"><a href="#cb14-304" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> w[<span class="dv">0</span>] <span class="op">==</span> LINEBREAK:</span>
<span id="cb14-305"><a href="#cb14-305" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> has_meta:</span>
<span id="cb14-306"><a href="#cb14-306" aria-hidden="true" tabindex="-1"></a>                        meta <span class="op">=</span> <span class="va">self</span>.text.metadata.pop(<span class="dv">0</span>)</span>
<span id="cb14-307"><a href="#cb14-307" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>._is_wordofinterest(w[<span class="dv">0</span>], <span class="dv">1</span>) <span class="kw">and</span> <span class="va">self</span>._has_condition(w[<span class="dv">1</span>:]):</span>
<span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> index, bigram <span class="kw">in</span> <span class="bu">enumerate</span>(itertools.product([w[<span class="dv">0</span>]], w[<span class="dv">1</span>:])):</span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a>                        bg <span class="op">=</span> _check_formulaic(bigram, <span class="bu">list</span>(w[<span class="dv">1</span>:]), index)</span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> has_meta:</span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a>                            _gather_meta(bg, meta)</span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a>                        d <span class="op">=</span> index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.distances.setdefault(bg, []).append(d)</span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">yield</span> bg</span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Selector for window type and distance tracking """</span></span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">TODO</span><span class="co">: Slice text into smaller parts to prevent memory errors</span></span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a>        <span class="co"># when analysing large texts</span></span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.symmetry:</span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.track_distance:</span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.bigram_freqs <span class="op">=</span> Counter(count_bigrams_symmetric_dist())</span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.bigram_freqs <span class="op">=</span> Counter(count_bigrams_symmetric())</span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.track_distance:</span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.bigram_freqs <span class="op">=</span> Counter(count_bigrams_forward_dist())</span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.bigram_freqs <span class="op">=</span> Counter(count_bigrams_forward())</span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a>        st2 <span class="op">=</span> time.time() <span class="op">-</span> st</span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a>        IO.show_time(st2, <span class="st">"Bigram counting"</span>)</span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> score(<span class="va">self</span>, measure):</span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Score text by using given measure and return dictionary</span></span>
<span id="cb14-337"><a href="#cb14-337" aria-hidden="true" tabindex="-1"></a><span class="co">        containing the results """</span></span>
<span id="cb14-338"><a href="#cb14-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-339"><a href="#cb14-339" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Scoring bigrams'</span>)</span>
<span id="cb14-340"><a href="#cb14-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-341"><a href="#cb14-341" aria-hidden="true" tabindex="-1"></a>        st <span class="op">=</span> time.time()</span>
<span id="cb14-342"><a href="#cb14-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-343"><a href="#cb14-343" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> scale(bf):</span>
<span id="cb14-344"><a href="#cb14-344" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Scale bigram frequency with window size to assure</span></span>
<span id="cb14-345"><a href="#cb14-345" aria-hidden="true" tabindex="-1"></a><span class="co">            Σ f(a,b) = Σ f(a) = Σ f(b) = N regardless of window size """</span></span>
<span id="cb14-346"><a href="#cb14-346" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> WINDOW_SCALING:</span>
<span id="cb14-347"><a href="#cb14-347" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.symmetry:</span>
<span id="cb14-348"><a href="#cb14-348" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> bf <span class="op">/</span> (<span class="va">self</span>.windowsize <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb14-349"><a href="#cb14-349" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-350"><a href="#cb14-350" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> bf <span class="op">/</span> (<span class="va">self</span>.windowsize <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb14-351"><a href="#cb14-351" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-352"><a href="#cb14-352" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> bf</span>
<span id="cb14-353"><a href="#cb14-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-354"><a href="#cb14-354" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> apply_weight(ab, a, b, cs, F):</span>
<span id="cb14-355"><a href="#cb14-355" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Apply only to joint-probability</span></span>
<span id="cb14-356"><a href="#cb14-356" aria-hidden="true" tabindex="-1"></a>            abf <span class="op">=</span> ab <span class="op">*</span> (F<span class="op">**</span><span class="va">self</span>.factorpower)</span>
<span id="cb14-357"><a href="#cb14-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-358"><a href="#cb14-358" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> abf, a, b, cs</span>
<span id="cb14-359"><a href="#cb14-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-360"><a href="#cb14-360" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.measure <span class="op">=</span> measure.<span class="va">__name__</span></span>
<span id="cb14-361"><a href="#cb14-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-362"><a href="#cb14-362" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Declare container for collocation data """</span></span>
<span id="cb14-363"><a href="#cb14-363" aria-hidden="true" tabindex="-1"></a>        scored <span class="op">=</span> {<span class="st">'freqs'</span>: {},</span>
<span id="cb14-364"><a href="#cb14-364" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'translations'</span>: {},</span>
<span id="cb14-365"><a href="#cb14-365" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'collocations'</span>: {},</span>
<span id="cb14-366"><a href="#cb14-366" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'words1'</span>: [],</span>
<span id="cb14-367"><a href="#cb14-367" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'words2'</span>: []}</span>
<span id="cb14-368"><a href="#cb14-368" aria-hidden="true" tabindex="-1"></a>        w1list, w2list <span class="op">=</span> [], []</span>
<span id="cb14-369"><a href="#cb14-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-370"><a href="#cb14-370" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Score and store bigrams, translations etc. """</span></span>
<span id="cb14-371"><a href="#cb14-371" aria-hidden="true" tabindex="-1"></a>        F_MEASURE <span class="op">=</span> <span class="va">self</span>.formulaic_measure</span>
<span id="cb14-372"><a href="#cb14-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-373"><a href="#cb14-373" aria-hidden="true" tabindex="-1"></a>        <span class="co"># DEBUG: Test that Σ f(a,b) = Σ f(a) = Σ f(b) = N holds</span></span>
<span id="cb14-374"><a href="#cb14-374" aria-hidden="true" tabindex="-1"></a>        <span class="co"># when calculating I(σ+;σ+)</span></span>
<span id="cb14-375"><a href="#cb14-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-376"><a href="#cb14-376" aria-hidden="true" tabindex="-1"></a>        _abs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-377"><a href="#cb14-377" aria-hidden="true" tabindex="-1"></a>        _as <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="va">self</span>.word_freqs.items() <span class="cf">if</span> k <span class="kw">not</span> <span class="kw">in</span> IGNORE])</span>
<span id="cb14-378"><a href="#cb14-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-379"><a href="#cb14-379" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Set scoring function according to weighting type """</span></span>
<span id="cb14-380"><a href="#cb14-380" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if self.preweight:</span></span>
<span id="cb14-381"><a href="#cb14-381" aria-hidden="true" tabindex="-1"></a>        <span class="co">#    SCORE = measure.score_pre_csim</span></span>
<span id="cb14-382"><a href="#cb14-382" aria-hidden="true" tabindex="-1"></a>        <span class="co">#else:</span></span>
<span id="cb14-383"><a href="#cb14-383" aria-hidden="true" tabindex="-1"></a>        <span class="co">#    SCORE = measure.score</span></span>
<span id="cb14-384"><a href="#cb14-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-385"><a href="#cb14-385" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" EXPERIMENTAL:</span></span>
<span id="cb14-386"><a href="#cb14-386" aria-hidden="true" tabindex="-1"></a><span class="co">        Estimate number of all bigrams for contingency tables """</span></span>
<span id="cb14-387"><a href="#cb14-387" aria-hidden="true" tabindex="-1"></a>        all_bigrams <span class="op">=</span> scale((<span class="va">self</span>.windowsize<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> <span class="va">self</span>.corpus_size)</span>
<span id="cb14-388"><a href="#cb14-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-389"><a href="#cb14-389" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bigram <span class="kw">in</span> <span class="va">self</span>.bigram_freqs.keys():</span>
<span id="cb14-390"><a href="#cb14-390" aria-hidden="true" tabindex="-1"></a>            w1, w2 <span class="op">=</span> bigram</span>
<span id="cb14-391"><a href="#cb14-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-392"><a href="#cb14-392" aria-hidden="true" tabindex="-1"></a>            <span class="co"># DEBUG, see above</span></span>
<span id="cb14-393"><a href="#cb14-393" aria-hidden="true" tabindex="-1"></a>            _abs <span class="op">+=</span> scale(<span class="va">self</span>.bigram_freqs[bigram])</span>
<span id="cb14-394"><a href="#cb14-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-395"><a href="#cb14-395" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>._is_valid(w1, w2, <span class="va">self</span>.bigram_freqs[bigram]):</span>
<span id="cb14-396"><a href="#cb14-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-397"><a href="#cb14-397" aria-hidden="true" tabindex="-1"></a>                freq_w1 <span class="op">=</span> <span class="va">self</span>.word_freqs[w1]</span>
<span id="cb14-398"><a href="#cb14-398" aria-hidden="true" tabindex="-1"></a>                freq_w2 <span class="op">=</span> <span class="va">self</span>.word_freqs[w2]</span>
<span id="cb14-399"><a href="#cb14-399" aria-hidden="true" tabindex="-1"></a>                distance <span class="op">=</span> <span class="va">self</span>._get_distance(bigram)</span>
<span id="cb14-400"><a href="#cb14-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-401"><a href="#cb14-401" aria-hidden="true" tabindex="-1"></a>                <span class="co">""" Apply context similarity measure"""</span></span>
<span id="cb14-402"><a href="#cb14-402" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.formulaic_measure <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb14-403"><a href="#cb14-403" aria-hidden="true" tabindex="-1"></a>                    csim_factor <span class="op">=</span> F_MEASURE.score(<span class="va">self</span>.WINS[bigram], w2)</span>
<span id="cb14-404"><a href="#cb14-404" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-405"><a href="#cb14-405" aria-hidden="true" tabindex="-1"></a>                    csim_factor <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-406"><a href="#cb14-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-407"><a href="#cb14-407" aria-hidden="true" tabindex="-1"></a>                <span class="co">""" Smooth for zero-division errors """</span></span>
<span id="cb14-408"><a href="#cb14-408" aria-hidden="true" tabindex="-1"></a>                csim_factor <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span><span class="op">-</span>csim_factor, <span class="fl">00000.1</span>)</span>
<span id="cb14-409"><a href="#cb14-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-410"><a href="#cb14-410" aria-hidden="true" tabindex="-1"></a>                <span class="co">""" Apply CSW to joint distribution if postweight not selected;</span></span>
<span id="cb14-411"><a href="#cb14-411" aria-hidden="true" tabindex="-1"></a><span class="co">                otherwise apply CSW on the final score """</span></span>
<span id="cb14-412"><a href="#cb14-412" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.formulaic_measure <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="kw">not</span> <span class="va">self</span>.postweight:</span>
<span id="cb14-413"><a href="#cb14-413" aria-hidden="true" tabindex="-1"></a>                    ab, a, b, cs <span class="op">=</span> apply_weight(<span class="va">self</span>.bigram_freqs[bigram],</span>
<span id="cb14-414"><a href="#cb14-414" aria-hidden="true" tabindex="-1"></a>                                                freq_w1,</span>
<span id="cb14-415"><a href="#cb14-415" aria-hidden="true" tabindex="-1"></a>                                                freq_w2,</span>
<span id="cb14-416"><a href="#cb14-416" aria-hidden="true" tabindex="-1"></a>                                                <span class="va">self</span>.corpus_size,</span>
<span id="cb14-417"><a href="#cb14-417" aria-hidden="true" tabindex="-1"></a>                                                csim_factor)</span>
<span id="cb14-418"><a href="#cb14-418" aria-hidden="true" tabindex="-1"></a>                    factor <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-419"><a href="#cb14-419" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-420"><a href="#cb14-420" aria-hidden="true" tabindex="-1"></a>                    ab, a, b, cs <span class="op">=</span> (<span class="va">self</span>.bigram_freqs[bigram],</span>
<span id="cb14-421"><a href="#cb14-421" aria-hidden="true" tabindex="-1"></a>                                    freq_w1,</span>
<span id="cb14-422"><a href="#cb14-422" aria-hidden="true" tabindex="-1"></a>                                    freq_w2,</span>
<span id="cb14-423"><a href="#cb14-423" aria-hidden="true" tabindex="-1"></a>                                    <span class="va">self</span>.corpus_size)</span>
<span id="cb14-424"><a href="#cb14-424" aria-hidden="true" tabindex="-1"></a>                    factor <span class="op">=</span> csim_factor</span>
<span id="cb14-425"><a href="#cb14-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-426"><a href="#cb14-426" aria-hidden="true" tabindex="-1"></a>                score <span class="op">=</span> measure.score(scale(ab), a, b, cs, factor, all_bigrams)</span>
<span id="cb14-427"><a href="#cb14-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-428"><a href="#cb14-428" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> {<span class="st">'score'</span>: score,</span>
<span id="cb14-429"><a href="#cb14-429" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'distance'</span>: distance,</span>
<span id="cb14-430"><a href="#cb14-430" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'frequency'</span>: <span class="va">self</span>.bigram_freqs[bigram],</span>
<span id="cb14-431"><a href="#cb14-431" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'similarity'</span>: <span class="dv">1</span><span class="op">-</span>csim_factor,</span>
<span id="cb14-432"><a href="#cb14-432" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'metadata'</span>: <span class="va">self</span>.metadata.get(bigram, <span class="va">None</span>)}</span>
<span id="cb14-433"><a href="#cb14-433" aria-hidden="true" tabindex="-1"></a>                scored[<span class="st">'translations'</span>][w1] <span class="op">=</span> <span class="va">self</span>._get_translation(w1)</span>
<span id="cb14-434"><a href="#cb14-434" aria-hidden="true" tabindex="-1"></a>                scored[<span class="st">'translations'</span>][w2] <span class="op">=</span> <span class="va">self</span>._get_translation(w2)</span>
<span id="cb14-435"><a href="#cb14-435" aria-hidden="true" tabindex="-1"></a>                scored[<span class="st">'freqs'</span>][w1] <span class="op">=</span> freq_w1</span>
<span id="cb14-436"><a href="#cb14-436" aria-hidden="true" tabindex="-1"></a>                scored[<span class="st">'freqs'</span>][w2] <span class="op">=</span> freq_w2</span>
<span id="cb14-437"><a href="#cb14-437" aria-hidden="true" tabindex="-1"></a>                w1list.append(w1)</span>
<span id="cb14-438"><a href="#cb14-438" aria-hidden="true" tabindex="-1"></a>                w2list.append(w2)</span>
<span id="cb14-439"><a href="#cb14-439" aria-hidden="true" tabindex="-1"></a>                <span class="co"># </span><span class="al">TODO</span><span class="co">: use setdefault instead of force</span></span>
<span id="cb14-440"><a href="#cb14-440" aria-hidden="true" tabindex="-1"></a>                <span class="co"># </span><span class="al">TODO</span><span class="co">: rearrange results into printable format on the fly</span></span>
<span id="cb14-441"><a href="#cb14-441" aria-hidden="true" tabindex="-1"></a>                <span class="co">#       instead of nested JSON which is slow to parse</span></span>
<span id="cb14-442"><a href="#cb14-442" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb14-443"><a href="#cb14-443" aria-hidden="true" tabindex="-1"></a>                    scored[<span class="st">'collocations'</span>][w1][w2] <span class="op">=</span> data</span>
<span id="cb14-444"><a href="#cb14-444" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb14-445"><a href="#cb14-445" aria-hidden="true" tabindex="-1"></a>                    scored[<span class="st">'collocations'</span>][w1] <span class="op">=</span> {}</span>
<span id="cb14-446"><a href="#cb14-446" aria-hidden="true" tabindex="-1"></a>                    scored[<span class="st">'collocations'</span>][w1][w2] <span class="op">=</span> data</span>
<span id="cb14-447"><a href="#cb14-447" aria-hidden="true" tabindex="-1"></a>                <span class="cf">finally</span>:</span>
<span id="cb14-448"><a href="#cb14-448" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">pass</span></span>
<span id="cb14-449"><a href="#cb14-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-450"><a href="#cb14-450" aria-hidden="true" tabindex="-1"></a>        <span class="co"># DEBUG, see above: print f(a,b) and f(b) = f(a) if calculated for *</span></span>
<span id="cb14-451"><a href="#cb14-451" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print('DEBUG:sanity check:',round(_abs), _as)</span></span>
<span id="cb14-452"><a href="#cb14-452" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k,v <span class="kw">in</span> <span class="va">self</span>.bigram_freqs.items():</span>
<span id="cb14-453"><a href="#cb14-453" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span><span class="co">#print(k,v)</span></span>
<span id="cb14-454"><a href="#cb14-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-455"><a href="#cb14-455" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Store words of interest for JSON """</span></span>
<span id="cb14-456"><a href="#cb14-456" aria-hidden="true" tabindex="-1"></a>        scored[<span class="st">'words1'</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(w1list))</span>
<span id="cb14-457"><a href="#cb14-457" aria-hidden="true" tabindex="-1"></a>        scored[<span class="st">'words2'</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(w2list))</span>
<span id="cb14-458"><a href="#cb14-458" aria-hidden="true" tabindex="-1"></a>        scored[<span class="st">'minimum'</span>] <span class="op">=</span> measure.minimum</span>
<span id="cb14-459"><a href="#cb14-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-460"><a href="#cb14-460" aria-hidden="true" tabindex="-1"></a>        st2 <span class="op">=</span> time.time() <span class="op">-</span> st</span>
<span id="cb14-461"><a href="#cb14-461" aria-hidden="true" tabindex="-1"></a>        IO.show_time(st2, <span class="st">"Scoring bigrams"</span>)</span>
<span id="cb14-462"><a href="#cb14-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-463"><a href="#cb14-463" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> scored</span>
<span id="cb14-464"><a href="#cb14-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-465"><a href="#cb14-465" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" ================================================================</span></span>
<span id="cb14-466"><a href="#cb14-466" aria-hidden="true" tabindex="-1"></a><span class="co">    Pretty-printing results ============================================</span></span>
<span id="cb14-467"><a href="#cb14-467" aria-hidden="true" tabindex="-1"></a><span class="co">    ================================================================ """</span></span>
<span id="cb14-468"><a href="#cb14-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-469"><a href="#cb14-469" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _stringify(<span class="va">self</span>, array):</span>
<span id="cb14-470"><a href="#cb14-470" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Convert all values in table into strings and</span></span>
<span id="cb14-471"><a href="#cb14-471" aria-hidden="true" tabindex="-1"></a><span class="co">        localize decimal markers. """</span></span>
<span id="cb14-472"><a href="#cb14-472" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _format_decimal(item):</span>
<span id="cb14-473"><a href="#cb14-473" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">float</span>):</span>
<span id="cb14-474"><a href="#cb14-474" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">str</span>(item).replace(<span class="st">'.'</span>, DECIMALSEPARATOR)</span>
<span id="cb14-475"><a href="#cb14-475" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb14-476"><a href="#cb14-476" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="bu">str</span>(item)</span>
<span id="cb14-477"><a href="#cb14-477" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [_format_decimal(x) <span class="cf">for</span> x <span class="kw">in</span> array]</span>
<span id="cb14-478"><a href="#cb14-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-479"><a href="#cb14-479" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _sort_by_index(<span class="va">self</span>, table, indices):</span>
<span id="cb14-480"><a href="#cb14-480" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Sort table by given two indices, i.e. [0, 4] sorts</span></span>
<span id="cb14-481"><a href="#cb14-481" aria-hidden="true" tabindex="-1"></a><span class="co">        the table by 1st and 5th values """</span></span>
<span id="cb14-482"><a href="#cb14-482" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> indices[<span class="dv">0</span>]</span>
<span id="cb14-483"><a href="#cb14-483" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> indices[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb14-484"><a href="#cb14-484" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sorted</span>(table, key<span class="op">=</span><span class="kw">lambda</span> item: (item[i], item[j]), reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-485"><a href="#cb14-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-486"><a href="#cb14-486" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> print_matrix(<span class="va">self</span>, scores, value<span class="op">=</span><span class="st">'score'</span>, filename<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-487"><a href="#cb14-487" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Arguments: ´scores´ dictionary (or JSON) produced by</span></span>
<span id="cb14-488"><a href="#cb14-488" aria-hidden="true" tabindex="-1"></a><span class="co">        Associations.score(); ´value´ must be ´score´, ´frequency´ or</span></span>
<span id="cb14-489"><a href="#cb14-489" aria-hidden="true" tabindex="-1"></a><span class="co">        ´distance´; set ´filename´ to write output into a file """</span></span>
<span id="cb14-490"><a href="#cb14-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-491"><a href="#cb14-491" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Building score matrix'</span>)</span>
<span id="cb14-492"><a href="#cb14-492" aria-hidden="true" tabindex="-1"></a>        st <span class="op">=</span> time.time()</span>
<span id="cb14-493"><a href="#cb14-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-494"><a href="#cb14-494" aria-hidden="true" tabindex="-1"></a>        output <span class="op">=</span> []</span>
<span id="cb14-495"><a href="#cb14-495" aria-hidden="true" tabindex="-1"></a>        heading <span class="op">=</span> [value.upper() <span class="op">+</span> <span class="st">' W1 --&gt;'</span>]</span>
<span id="cb14-496"><a href="#cb14-496" aria-hidden="true" tabindex="-1"></a>        heading <span class="op">+=</span> [<span class="st">'</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(w <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> scores[<span class="st">'translations'</span>][w])<span class="op">\</span></span>
<span id="cb14-497"><a href="#cb14-497" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> w <span class="kw">in</span> scores[<span class="st">'words2'</span>]]</span>
<span id="cb14-498"><a href="#cb14-498" aria-hidden="true" tabindex="-1"></a>        rows <span class="op">=</span> [heading]</span>
<span id="cb14-499"><a href="#cb14-499" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> w1 <span class="kw">in</span> <span class="bu">sorted</span>(scores[<span class="st">'words1'</span>]):</span>
<span id="cb14-500"><a href="#cb14-500" aria-hidden="true" tabindex="-1"></a>            row <span class="op">=</span> []</span>
<span id="cb14-501"><a href="#cb14-501" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> w2 <span class="kw">in</span> <span class="bu">sorted</span>(scores[<span class="st">'words2'</span>]):</span>
<span id="cb14-502"><a href="#cb14-502" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> HIDE_MIN_SCORE:</span>
<span id="cb14-503"><a href="#cb14-503" aria-hidden="true" tabindex="-1"></a>                    score <span class="op">=</span> <span class="st">''</span></span>
<span id="cb14-504"><a href="#cb14-504" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb14-505"><a href="#cb14-505" aria-hidden="true" tabindex="-1"></a>                    score <span class="op">=</span> scores[<span class="st">'minimum'</span>]</span>
<span id="cb14-506"><a href="#cb14-506" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> w1 <span class="kw">in</span> scores[<span class="st">'collocations'</span>].keys():</span>
<span id="cb14-507"><a href="#cb14-507" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> w2 <span class="kw">in</span> scores[<span class="st">'collocations'</span>][w1].keys():</span>
<span id="cb14-508"><a href="#cb14-508" aria-hidden="true" tabindex="-1"></a>                        bigram <span class="op">=</span> scores[<span class="st">'collocations'</span>][w1][w2]</span>
<span id="cb14-509"><a href="#cb14-509" aria-hidden="true" tabindex="-1"></a>                        score <span class="op">=</span> bigram.get(value, <span class="va">None</span>)</span>
<span id="cb14-510"><a href="#cb14-510" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> score <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-511"><a href="#cb14-511" aria-hidden="true" tabindex="-1"></a>                            IO.errormsg(<span class="st">'bad argument "</span><span class="sc">%s</span><span class="st">" for print_matrix().'</span> <span class="op">%</span> value)</span>
<span id="cb14-512"><a href="#cb14-512" aria-hidden="true" tabindex="-1"></a>                            sys.exit(<span class="dv">0</span>)</span>
<span id="cb14-513"><a href="#cb14-513" aria-hidden="true" tabindex="-1"></a>                row.append(<span class="va">self</span>._trim_float(score))</span>
<span id="cb14-514"><a href="#cb14-514" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">any</span>(row) <span class="kw">and</span> w1 <span class="kw">not</span> <span class="kw">in</span> LACUNAE <span class="op">+</span> [BUFFER, LINEBREAK]:</span>
<span id="cb14-515"><a href="#cb14-515" aria-hidden="true" tabindex="-1"></a>                rows.append([w1] <span class="op">+</span> row)</span>
<span id="cb14-516"><a href="#cb14-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-517"><a href="#cb14-517" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Rotate to clean empty columns """</span></span>
<span id="cb14-518"><a href="#cb14-518" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> r <span class="kw">in</span> [row <span class="cf">for</span> row <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>rows) <span class="cf">if</span> <span class="bu">any</span>(row[<span class="dv">1</span>:])]:</span>
<span id="cb14-519"><a href="#cb14-519" aria-hidden="true" tabindex="-1"></a>            output.append(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>.join([<span class="bu">str</span>(x) <span class="cf">for</span> x <span class="kw">in</span> r]))</span>
<span id="cb14-520"><a href="#cb14-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-521"><a href="#cb14-521" aria-hidden="true" tabindex="-1"></a>        st2 <span class="op">=</span> time.time() <span class="op">-</span> st</span>
<span id="cb14-522"><a href="#cb14-522" aria-hidden="true" tabindex="-1"></a>        IO.show_time(st2, <span class="st">"Building matrix"</span>)</span>
<span id="cb14-523"><a href="#cb14-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-524"><a href="#cb14-524" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb14-525"><a href="#cb14-525" aria-hidden="true" tabindex="-1"></a>            IO.write_file(filename, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(output))</span>
<span id="cb14-526"><a href="#cb14-526" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-527"><a href="#cb14-527" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(output))</span>
<span id="cb14-528"><a href="#cb14-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-529"><a href="#cb14-529" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> print_scores(<span class="va">self</span>, scores, limit<span class="op">=</span><span class="dv">10000</span>, sortby<span class="op">=</span>(<span class="st">'word1'</span>, <span class="st">'score'</span>),</span>
<span id="cb14-530"><a href="#cb14-530" aria-hidden="true" tabindex="-1"></a>                     gephi<span class="op">=</span><span class="va">False</span>, filename<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb14-531"><a href="#cb14-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-532"><a href="#cb14-532" aria-hidden="true" tabindex="-1"></a>        st <span class="op">=</span> time.time()</span>
<span id="cb14-533"><a href="#cb14-533" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">': Building score table'</span>)</span>
<span id="cb14-534"><a href="#cb14-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-535"><a href="#cb14-535" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> merge_dict(dict1, dict2):</span>
<span id="cb14-536"><a href="#cb14-536" aria-hidden="true" tabindex="-1"></a>           <span class="co">""" Merge dictionaries and sum the sign frequencies """</span></span>
<span id="cb14-537"><a href="#cb14-537" aria-hidden="true" tabindex="-1"></a>           combined <span class="op">=</span> {<span class="op">**</span>dict1, <span class="op">**</span>dict2}</span>
<span id="cb14-538"><a href="#cb14-538" aria-hidden="true" tabindex="-1"></a>           <span class="cf">for</span> key, value <span class="kw">in</span> combined.items():</span>
<span id="cb14-539"><a href="#cb14-539" aria-hidden="true" tabindex="-1"></a>               <span class="cf">if</span> key <span class="kw">in</span> dict1 <span class="kw">and</span> key <span class="kw">in</span> dict2:</span>
<span id="cb14-540"><a href="#cb14-540" aria-hidden="true" tabindex="-1"></a>                   combined[key] <span class="op">=</span> value <span class="op">+</span> dict1[key]</span>
<span id="cb14-541"><a href="#cb14-541" aria-hidden="true" tabindex="-1"></a>           <span class="cf">return</span> combined</span>
<span id="cb14-542"><a href="#cb14-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-543"><a href="#cb14-543" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> collate_meta(meta):</span>
<span id="cb14-544"><a href="#cb14-544" aria-hidden="true" tabindex="-1"></a>            <span class="co">""" Combine multi-value metadata; e.g. SB|Nippur|Literary</span></span>
<span id="cb14-545"><a href="#cb14-545" aria-hidden="true" tabindex="-1"></a><span class="co">            will be split into three additional subdictionaries and</span></span>
<span id="cb14-546"><a href="#cb14-546" aria-hidden="true" tabindex="-1"></a><span class="co">            frequency data is collated. """</span></span>
<span id="cb14-547"><a href="#cb14-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-548"><a href="#cb14-548" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">TODO</span><span class="co">: Aliases</span></span>
<span id="cb14-549"><a href="#cb14-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-550"><a href="#cb14-550" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> meta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-551"><a href="#cb14-551" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> meta</span>
<span id="cb14-552"><a href="#cb14-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-553"><a href="#cb14-553" aria-hidden="true" tabindex="-1"></a>            vals <span class="op">=</span> <span class="bu">len</span>(<span class="bu">list</span>(meta.keys())[<span class="dv">0</span>].split(<span class="st">'|'</span>))</span>
<span id="cb14-554"><a href="#cb14-554" aria-hidden="true" tabindex="-1"></a>            original <span class="op">=</span> {i<span class="op">+</span><span class="dv">1</span>:{} <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, vals)}</span>
<span id="cb14-555"><a href="#cb14-555" aria-hidden="true" tabindex="-1"></a>            original[<span class="dv">0</span>] <span class="op">=</span> meta</span>
<span id="cb14-556"><a href="#cb14-556" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> key, val <span class="kw">in</span> meta.items():</span>
<span id="cb14-557"><a href="#cb14-557" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> slot, k <span class="kw">in</span> <span class="bu">enumerate</span>(key.split(<span class="st">'|'</span>)):</span>
<span id="cb14-558"><a href="#cb14-558" aria-hidden="true" tabindex="-1"></a>                    original[slot<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> merge_dict({k: val}, original[slot<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb14-559"><a href="#cb14-559" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> original</span>
<span id="cb14-560"><a href="#cb14-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-561"><a href="#cb14-561" aria-hidden="true" tabindex="-1"></a>        header <span class="op">=</span> [<span class="st">'word1'</span>,  <span class="st">'word2'</span>,  <span class="st">'word1 freq'</span>, <span class="st">'word2 freq'</span>,</span>
<span id="cb14-562"><a href="#cb14-562" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'bigram freq'</span>, <span class="st">'score'</span>, <span class="st">'distance'</span>, <span class="st">'similarity'</span>, <span class="st">'url'</span>]</span>
<span id="cb14-563"><a href="#cb14-563" aria-hidden="true" tabindex="-1"></a>        sort_indices <span class="op">=</span> [header.index(x) <span class="cf">for</span> x <span class="kw">in</span> sortby]</span>
<span id="cb14-564"><a href="#cb14-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-565"><a href="#cb14-565" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Set headers """</span></span>
<span id="cb14-566"><a href="#cb14-566" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gephi:</span>
<span id="cb14-567"><a href="#cb14-567" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> [(<span class="st">';'</span>.join([<span class="st">'source'</span>, <span class="st">'target'</span>, <span class="st">'weight'</span>]))]</span>
<span id="cb14-568"><a href="#cb14-568" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-569"><a href="#cb14-569" aria-hidden="true" tabindex="-1"></a>            output <span class="op">=</span> [<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>.join([x <span class="cf">for</span> x <span class="kw">in</span> header])]</span>
<span id="cb14-570"><a href="#cb14-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-571"><a href="#cb14-571" aria-hidden="true" tabindex="-1"></a>        rows <span class="op">=</span> []</span>
<span id="cb14-572"><a href="#cb14-572" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> w1 <span class="kw">in</span> scores[<span class="st">'collocations'</span>].keys():</span>
<span id="cb14-573"><a href="#cb14-573" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> w2 <span class="kw">in</span> scores[<span class="st">'collocations'</span>][w1].keys():</span>
<span id="cb14-574"><a href="#cb14-574" aria-hidden="true" tabindex="-1"></a>                bigram <span class="op">=</span> scores[<span class="st">'collocations'</span>][w1][w2]</span>
<span id="cb14-575"><a href="#cb14-575" aria-hidden="true" tabindex="-1"></a>                freqs <span class="op">=</span> scores[<span class="st">'freqs'</span>]</span>
<span id="cb14-576"><a href="#cb14-576" aria-hidden="true" tabindex="-1"></a>                meta <span class="op">=</span> collate_meta(bigram[<span class="st">'metadata'</span>])</span>
<span id="cb14-577"><a href="#cb14-577" aria-hidden="true" tabindex="-1"></a>                items <span class="op">=</span> {<span class="st">'word1'</span>: w1,</span>
<span id="cb14-578"><a href="#cb14-578" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'word2'</span>: w2,</span>
<span id="cb14-579"><a href="#cb14-579" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#'attr1': scores['translations'][w1],</span></span>
<span id="cb14-580"><a href="#cb14-580" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#'attr2': scores['translations'][w2],</span></span>
<span id="cb14-581"><a href="#cb14-581" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'word1 freq'</span>: freqs[w1],</span>
<span id="cb14-582"><a href="#cb14-582" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'word2 freq'</span>: freqs[w2],</span>
<span id="cb14-583"><a href="#cb14-583" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'bigram freq'</span>: bigram[<span class="st">'frequency'</span>],</span>
<span id="cb14-584"><a href="#cb14-584" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#'metaa': meta,</span></span>
<span id="cb14-585"><a href="#cb14-585" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'score'</span>:</span>
<span id="cb14-586"><a href="#cb14-586" aria-hidden="true" tabindex="-1"></a>                             <span class="bu">float</span>(<span class="va">self</span>._trim_float(bigram[<span class="st">'score'</span>])),</span>
<span id="cb14-587"><a href="#cb14-587" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'distance'</span>: bigram[<span class="st">'distance'</span>],</span>
<span id="cb14-588"><a href="#cb14-588" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'similarity'</span>: <span class="va">self</span>._trim_float(bigram[<span class="st">'similarity'</span>]),</span>
<span id="cb14-589"><a href="#cb14-589" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'url'</span>: make_korp_oracc_url(w1, w2, <span class="va">self</span>.windowsize<span class="op">-</span><span class="dv">2</span>)}</span>
<span id="cb14-590"><a href="#cb14-590" aria-hidden="true" tabindex="-1"></a>                rows.append([items[key] <span class="cf">for</span> key <span class="kw">in</span> header])</span>
<span id="cb14-591"><a href="#cb14-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-592"><a href="#cb14-592" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" Sort and convert into tsv """</span></span>
<span id="cb14-593"><a href="#cb14-593" aria-hidden="true" tabindex="-1"></a>        lastword <span class="op">=</span> <span class="st">''</span></span>
<span id="cb14-594"><a href="#cb14-594" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> <span class="va">self</span>._sort_by_index(rows, sort_indices):</span>
<span id="cb14-595"><a href="#cb14-595" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> gephi:</span>
<span id="cb14-596"><a href="#cb14-596" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> lastword <span class="op">!=</span> line[<span class="dv">0</span>]:</span>
<span id="cb14-597"><a href="#cb14-597" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-598"><a href="#cb14-598" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">&lt;</span> limit:</span>
<span id="cb14-599"><a href="#cb14-599" aria-hidden="true" tabindex="-1"></a>                    output.append(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>.join(<span class="va">self</span>._stringify(line)))</span>
<span id="cb14-600"><a href="#cb14-600" aria-hidden="true" tabindex="-1"></a>                lastword <span class="op">=</span> line[<span class="dv">0</span>]</span>
<span id="cb14-601"><a href="#cb14-601" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-602"><a href="#cb14-602" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> gephi:</span>
<span id="cb14-603"><a href="#cb14-603" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> lastword <span class="op">!=</span> line[<span class="dv">0</span>]:</span>
<span id="cb14-604"><a href="#cb14-604" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-605"><a href="#cb14-605" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">&lt;</span> limit:</span>
<span id="cb14-606"><a href="#cb14-606" aria-hidden="true" tabindex="-1"></a>                    data <span class="op">=</span> [line[<span class="dv">0</span>]<span class="op">+</span><span class="st">' '</span><span class="op">+</span>line[<span class="dv">1</span>]] <span class="op">+</span> [line[<span class="dv">2</span>]<span class="op">+</span><span class="st">' '</span><span class="op">+</span>line[<span class="dv">3</span>]<span class="op">+</span><span class="st">' ('</span><span class="op">+</span><span class="bu">str</span>(line[<span class="dv">5</span>]) <span class="op">+</span><span class="st">')'</span>] <span class="op">+</span> [line[<span class="dv">7</span>]]</span>
<span id="cb14-607"><a href="#cb14-607" aria-hidden="true" tabindex="-1"></a>                    output.append(<span class="st">'</span><span class="ch">\t</span><span class="st">'</span>.join(<span class="va">self</span>._stringify(data)))</span>
<span id="cb14-608"><a href="#cb14-608" aria-hidden="true" tabindex="-1"></a>                lastword <span class="op">=</span> line[<span class="dv">0</span>]</span>
<span id="cb14-609"><a href="#cb14-609" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-610"><a href="#cb14-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-611"><a href="#cb14-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-612"><a href="#cb14-612" aria-hidden="true" tabindex="-1"></a>        st2 <span class="op">=</span> time.time() <span class="op">-</span> st</span>
<span id="cb14-613"><a href="#cb14-613" aria-hidden="true" tabindex="-1"></a>        IO.show_time(st2, <span class="st">"Building score table"</span>)</span>
<span id="cb14-614"><a href="#cb14-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-615"><a href="#cb14-615" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb14-616"><a href="#cb14-616" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(output))</span>
<span id="cb14-617"><a href="#cb14-617" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb14-618"><a href="#cb14-618" aria-hidden="true" tabindex="-1"></a>            IO.write_file(filename, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(output))</span>
<span id="cb14-619"><a href="#cb14-619" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="set-options-and-run-the-script" class="level2">
<h2 class="anchored" data-anchor-id="set-options-and-run-the-script">Set options and run the script</h2>
<p><strong>This is the part of the script that can be safely modified.</strong></p>
<p><strong>DEFINING KEYWORDS:</strong></p>
<ul>
<li><div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>words1<span class="op">=</span>[<span class="st">'sisû[horse]N'</span>, <span class="st">'parû[mule]N'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Would find all collocates for <em>sisû</em> and <em>parû</em>. You can also use regular expressions but they must be precompiled, for example.</p></li>
<li><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>words1<span class="op">=</span>[re.<span class="bu">compile</span>(<span class="st">'banû.+'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Will find collocates for <em>banû</em> regarldess of their sense or part-of-speech. If you want to only find <em>banûs</em> that are adjectives, you can do</p></li>
<li><div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>words1<span class="op">=</span>[re.<span class="bu">compile</span>(<span class="st">'banû.+AJ'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p><strong>DEFINING CLOSED COLLOCATE SETS</strong></p>
<p>You can limit your possible collocates by defining words2. For example, if you only want to find collocates that are divine names, use</p>
<ul>
<li><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>words2<span class="op">=</span>[re.<span class="bu">compile</span>(<span class="st">'.*DN.*'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p><strong>DEFINING STOPWORDS</strong></p>
<p>Stopwords can be used to filter out groups of words from your collocate lists. For example, if you want to filter out all proper names and royal names, you can use the regular expression [RD]N, that is (RN|DN).</p>
<ul>
<li><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>stopwords<span class="op">=</span>[re.<span class="bu">compile</span>(<span class="st">'.*([RD]N).*'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p>In general its faster to define stopwords in inverse by using words2, e.g.</p>
<ul>
<li><div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>words2<span class="op">=</span>[re.<span class="bu">compile</span>(<span class="st">'.*</span><span class="er">\</span><span class="st">](N|AJ|V).*'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p>disallows <em>ALL</em> collocates other than nouns, adjectives and verbs.</p>
<p><strong>DEFINING CONDITIONS (ADVANCED FEATURE)</strong></p>
<p>To define conditions for your collocates, you can use arguments <code>conditions</code> and <code>positive_condition</code>. For example, the following arguments</p>
<ul>
<li><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>words1<span class="op">=</span>[<span class="st">'kakku[weapon]N'</span>],</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>conditions<span class="op">=</span>[re.<span class="bu">compile</span>(<span class="st">'.*naparšudu.*'</span>)],</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>positive_condition<span class="op">=</span><span class="va">False</span>,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
will calculate collocates for <em>kakku[weapon]N ONLY</em> if the word <em>naparšudu</em> does not exist within the window.</li>
</ul>
<p>On the contrary, the following would find collocates for <em>kakku[weapon]N</em> only if <em>naparšudu</em> exists in the window.</p>
<ul>
<li><div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>words1<span class="op">=</span>[<span class="st">'kakku[weapon]N'</span>],</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    conditions<span class="op">=</span>[re.<span class="bu">compile</span>(<span class="st">'.*naparšudu.*'</span>)],</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    positive_condition<span class="op">=</span><span class="va">True</span>,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p><strong>AUTO-GENERATING STOPWORD LISTS (ADVANCED FEATURE)</strong></p>
<ul>
<li><div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>stopwords<span class="op">=</span>z.tf_idf(threshold<span class="op">=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
Will generate a list of 1000 most uninteresting words in the text by using TF-IDF. Note that this is a part of the Text class.</li>
</ul>
<div id="D1KQeEvorn4m" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898656401,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_file_from_github(url):</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fetch the content from URL</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    response.raise_for_status()  <span class="co"># Ensure we catch HTTP errors</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a temporary file to write the content</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    temp_file <span class="op">=</span> tempfile.NamedTemporaryFile(delete<span class="op">=</span><span class="va">False</span>, mode<span class="op">=</span><span class="st">'w+'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    temp_file.write(response.text)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    temp_file.close()  <span class="co"># Close the file to ensure it can be reopened by IO.read_file</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> temp_file.name  <span class="co"># Return the path of the temporary file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="jD1m1bKLrrCO" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898657359,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:959,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># URL of the raw file on GitHub</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/asahala/Pmizer/master/data/dataset.txt'</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>temp_filename <span class="op">=</span> fetch_file_from_github(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="505c02b1" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;executionInfo&quot;,&quot;value&quot;:{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1716898657359,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:3,&quot;user&quot;:{&quot;displayName&quot;:&quot;Eliese-Sophia Lincke&quot;,&quot;userId&quot;:&quot;10981543332841100954&quot;}}}" data-outputid="42d699bb-5ee9-402c-c6ed-3c3b364fb925" data-execution_count="12">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#z = Text('data/PMI_dataset.txt') # Dataset in TPL (text per line) format</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> Text(temp_filename)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>wz <span class="op">=</span> <span class="dv">5</span> <span class="co"># Window size</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> Associations(z,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                 words1<span class="op">=</span>[<span class="st">'maddattu[payment]N'</span>],      <span class="co"># keyword of interest</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#conditions=[re.compile('.*naparšudu.*')],</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#positive_condition=False,</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                 formulaic_measure<span class="op">=</span>Lazy,   <span class="co"># use CSW</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                 minfreq_b <span class="op">=</span> <span class="dv">2</span>,            <span class="co"># min collocate freq</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                 minfreq_ab <span class="op">=</span> <span class="dv">2</span>,           <span class="co"># min bigram freq</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                 symmetry<span class="op">=</span><span class="va">True</span>,            <span class="co"># use symmetric window</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                 windowsize<span class="op">=</span>wz,            <span class="co"># window size</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                 factorpower<span class="op">=</span><span class="dv">3</span>)            <span class="co"># CSW k-value</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> x.score(PMIDELTA)              <span class="co"># Select measure (e.g, PMI, PMI2, Jaccard...)</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Save results</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>x.print_scores(A, limit<span class="op">=</span><span class="dv">20</span>, gephi<span class="op">=</span><span class="va">False</span>, filename<span class="op">=</span><span class="st">'PMI_results.tsv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>: Reading /tmp/tmpidhw9is7
    Reading took 0.06 seconds

: Text statistics:
    Lines: 432
    Longest line: 6147
    Word count: 88252
    Word count (non-lacunae): 62469
    Lacunae or ignored symbols: 25783
    Unique words: 4149
    Median word frequency: 4
    Average word frequency: 21.47

: Counting bigrams
    Bigram counting took 0.13 seconds
: Scoring bigrams
    Scoring bigrams took 0.01 seconds
: Building score table
    Building score table took 0.01 seconds
: Saved PMI_results.tsv</code></pre>
</div>
</div>
</section>
<section id="critical-bug-fixes" class="level2">
<h2 class="anchored" data-anchor-id="critical-bug-fixes">Critical bug fixes</h2>
<pre><code>    2019-06-26: changed buffering from the end of the line
                to the beginning to prevent rare crash that
                occurred if the keyword was coincidentally
                in the middle of the first symmetric window.
                now linebreak is always the first symbol in text.

    2020-02-10: lazy context similarity algorithm now preserves
                lacuna positions. other algorithms are not
                recommended as they are not fixed yet.

    2020-03-03: regular expressions now work properly in forward-
                looking windows.

                symmetric window scaling is now correct and
                Σ f(a,b) = Σ f(a) = Σ f(b) = N when I(σ+;σ+)
                where σ is symbol of the alphabet.

    2020-05-20: Fix incorrect bounds for PMI3. Lazy context
                similarity measure now discards collocates
                from counts properly (i.e. subtracts 1 from
                the denominator).

    2024-05-19: Fix links to Korp.
    </code></pre>
</section>
<section id="other-fixes" class="level2">
<h2 class="anchored" data-anchor-id="other-fixes">Other fixes</h2>
<pre><code>    2020-11-27: Preweight is now default.

    2020-01-01: Additional measures such as Jaccard etc.</code></pre>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DigitalPasts">
      <i class="bi bi-github" role="img" aria-label="DigPasts GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/shgordin">
      <i class="bi bi-twitter" role="img" aria-label="Shai Gordin Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:digpasts@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
<p>© Digital Pasts Lab, 2025</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>